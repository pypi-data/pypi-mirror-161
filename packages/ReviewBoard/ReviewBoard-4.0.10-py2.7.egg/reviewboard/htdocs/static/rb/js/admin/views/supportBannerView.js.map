{"version":3,"sources":["supportBannerView.es6.js"],"names":[],"mappings":";;AAAA;AACA;AACA;AACA,EAAE,CAAC,iBAAH,GAAuB,QAAQ,CAAC,IAAT,CAAc,MAAd,CAAqB;EACxC,YAAY,EAAE,CAAC,CAAC,QAAF,oFAGX;IACC,SAAS;EADV,CAHW,CAD0B;EAQxC,UAAU,EAAE,CAAC,CAAC,QAAF,8EAIT;IACC,SAAS,mDADV;IAEC,QAAQ,kKAFT;IAGC,QAAQ;EAHT,CAJS,CAR4B;;EAkBxC;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACI,UAAU,CAAC,OAAD,EAAU;IAChB,MAAM,GAAG,GAAG,IAAI,IAAJ,EAAZ;IAEA,OAAO,CAAC,MAAR,CAAe,EAAE,CAAC,iBAAH,CAAqB,QAArB,KAAkC,IAAjD;IACA,EAAE,CAAC,iBAAH,CAAqB,QAArB,GAAgC,IAAhC;;IAEA,CAAC,CAAC,OAAF,CAAU,IAAV,EAAgB,UAAhB;;IAEA,MAAM,CAAC,gBAAP,CAAwB,OAAxB,EAAiC,KAAK,QAAtC,EAAgD,IAAhD;IAEA,KAAK,OAAL,GAAe,CAAC,CAAC,YAAD,CAAD,CACV,IADU,CACL,KADK,EACE,EAAE,CAAC,iBAAH,CAAqB,UAArB,GAAkC,GAAlC,GAAwC,CAAC,CAAC,KAAF,CAAQ;MACzD,gBAAgB,OAAO,CAAC,WADiC;MAEzD,QAAQ,EAAE,uCAF+C;MAGzD,CAAC,EAAE,GAAG,CAAC,OAAJ,EAHsD,CAGtC;;IAHsC,CAAR,CAD1C,EAMV,GANU,CAMN,CANM,CAAf;IAQA;AACR;AACA;AACA;;IACQ,QAAQ,CAAC,IAAT,CAAc,WAAd,CAA0B,KAAK,OAA/B;EAEH,CAtDuC;;EAwDxC;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACI,QAAQ,CAAC,CAAD,EAAI;IACR,IAAI,CAAC,CAAC,MAAF,KAAa,KAAK,OAAtB,EAA+B;MAC3B,KAAK,MAAL,CAAY;QACR,IAAI,EAAE,KAAK,UADH;QAER,SAAS,EAAE;MAFH,CAAZ;MAKA,MAAM,CAAC,mBAAP,CAA2B,OAA3B,EAAoC,KAAK,QAAzC,EAAmD,IAAnD;IACH;EACJ,CA3EuC;;EA6ExC;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACI,MAAM,CAAC,OAAD,EAAU;IACZ,OAAO,GAAG,CAAC,CAAC,MAAF,CAAS;MACf,SAAS,EAAE,SADI;MAEf,IAAI,EAAE,KAAK;IAFI,CAAT,EAGP,OAHO,CAAV;IAKA,KAAK,GAAL,CACK,KADL,GAEK,IAFL,CAEU,OAAO,CAAC,IAFlB,EAGK,IAHL,CAGU,OAHV,EAGmB,OAAO,CAAC,SAH3B;IAKA,OAAO,IAAP;EACH,CAvGuC;;EAyGxC;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACI,OAAO,CAAC,OAAD,EAAU;IACb,MAAM,CAAC,mBAAP,CAA2B,OAA3B,EAAoC,KAAK,QAAzC,EAAmD,IAAnD;IAEA,KAAK,MAAL,CAAY;MACR,SAAS,EAAE,OAAO,CAAC,YAAR,GAAuB,UAD1B;MAER,IAAI,EAAE,OAAO,CAAC;IAFN,CAAZ;EAIH;;AAhIuC,CAArB,EAiIpB;EACC,QAAQ,EAAE,IADX;EAEC,UAAU,EAAE;AAFb,CAjIoB,CAAvB","file":"supportBannerView.js","sourcesContent":["/**\n * Show the current support status for the Review Board install.\n */\nRB.SupportBannerView = Backbone.View.extend({\n    _loadingHTML: _.template(dedent`\n        <h2><%- titleText %></h2>\n        <p><span class=\"fa fa-spin fa-spinner\"></span></p>\n    `)({\n        titleText: gettext('Retrieving support information...'),\n    }),\n\n    _errorHTML: _.template(dedent`\n        <h2><%- titleText %></h2>\n        <p><%- bodyText %></p>\n        <p><%= fileText %></p>\n    `)({\n        titleText: gettext('Failed to retrieve support information'),\n        bodyText: gettext('We could not communicate with the Beanbag, Inc. server to retrieve your support information. You may be behind a firewall or have no Internet access.'),\n        fileText: gettext('You may file an issue on our <a href=\"https://reviewboard.googlegroups.com\">community support tracker.</a>'),\n    }),\n\n    /**\n     * Initialize the view.\n     *\n     * Args:\n     *     options (object):\n     *         Options passed to the view.\n     *\n     * Option Args:\n     *     supportData (string):\n     *         An encoded payload containing information used to look up\n     *         information on an active support contract for the server.\n     */\n    initialize(options) {\n        const now = new Date();\n\n        console.assert(RB.SupportBannerView.instance === null);\n        RB.SupportBannerView.instance = this;\n\n        _.bindAll(this, '_onError');\n\n        window.addEventListener('error', this._onError, true);\n\n        this._script = $('<script />')\n            .attr('src', RB.SupportBannerView.supportURL + '?' + $.param({\n                'support-data': options.supportData,\n                callback: 'RB.SupportBannerView.instance.receive',\n                _: now.valueOf(),  // Cache bust.\n            }))\n            .get(0);\n\n        /*\n         * If we use jQuery's appendTo, we end up with two <script> tags being\n         * added to the document.\n         */\n        document.body.appendChild(this._script);\n\n    },\n\n    /**\n     * Handle a DOM error.\n     *\n     * If the specified error targets the script tag (e.g., if it could not\n     * be loaded), then an error will be displayed in the banner\n     *\n     * Args:\n     *     e (Event):\n     *         The event that triggered this function.\n     */\n    _onError(e) {\n        if (e.target === this._script) {\n            this.render({\n                html: this._errorHTML,\n                className: 'error',\n            });\n\n            window.removeEventListener('error', this._onError, true);\n        }\n    },\n\n    /**\n     * Render the view\n     *\n     * Args:\n     *     options (object):\n     *         The rendering options.\n     *\n     * Option Args:\n     *     html (string)\n     *         The html to render in the banner.\n     *\n     *     className (string):\n     *         The name of the class to add to the banner.\n     */\n    render(options) {\n        options = _.extend({\n            className: 'loading',\n            html: this._loadingHTML,\n        }, options);\n\n        this.$el\n            .empty()\n            .html(options.html)\n            .attr('class', options.className);\n\n        return this;\n    },\n\n    /**\n     * Receive the data from the server.\n     *\n     * This is invoked via a JSONP callback.\n     *\n     * Args:\n     *     options (object):\n     *         The options received from the server.\n     *\n     * Option Args:\n     *     supportLevel (string):\n     *         The level of support the server has.\n     *\n     *     html (string):\n     *         The HTML to render in the banner.\n     */\n    receive(options) {\n        window.removeEventListener('error', this._onError, true);\n\n        this.render({\n            className: options.supportLevel + '-support',\n            html: options.html,\n        });\n    },\n}, {\n    instance: null,\n    supportURL: 'https://www.beanbaginc.com/support/reviewboard/_status/',\n});\n"]}