{"version":3,"sources":["joinedGroupsView.es6.js"],"names":[],"mappings":"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","file":"joinedGroupsView.js","sourcesContent":["(function() {\n\n\n/**\n * An item representing the user's membership with a group.\n *\n * This keeps track of the group's information and the membership state\n * for the user. It also allows changing that membership.\n *\n * This provides two actions: 'Join', and 'Leave'.\n */\nconst GroupMembershipItem = Djblets.Config.ListItem.extend({\n    defaults: _.defaults({\n        localSiteName: null,\n        displayName: null,\n        groupName: null,\n        joined: false,\n        showRemove: false,\n        url: null\n    }, Djblets.Config.ListItem.prototype.defaults),\n\n    /**\n     * Initialize the item.\n     *\n     * The item's name and URL will be taken from the serialized group\n     * information, and a proxy ReviewGroup will be created to handle\n     * membership.\n     */\n    initialize() {\n        Djblets.Config.ListItem.prototype.initialize.apply(this, arguments);\n\n        const name = this.get('name');\n        const localSiteName = this.get('localSiteName');\n\n        this.set({\n            text: name,\n            editURL: this.get('url')\n        });\n\n        this.group = new RB.ReviewGroup({\n            id: this.get('reviewGroupID'),\n            name: name,\n            localSitePrefix: (localSiteName ? 's/' + localSiteName + '/' : '')\n        });\n\n        this.on('change:joined', this._updateActions, this);\n        this._updateActions();\n    },\n\n    /**\n     * Join the group.\n     *\n     * This will add the user to the group, and set the 'joined' property\n     * to true upon completion.\n     */\n    joinGroup() {\n        this.group.addUser(\n            RB.UserSession.instance.get('username'),\n            {\n                success: () => this.set('joined', true)\n            });\n    },\n\n    /**\n     * Leave the group.\n     *\n     * This will remove the user from the group, and set the 'joined' property\n     * to false upon completion.\n     */\n    leaveGroup() {\n        this.group.removeUser(\n            RB.UserSession.instance.get('username'),\n            {\n                success: () => this.set('joined', false)\n            });\n    },\n\n    /**\n     * Update the list of actions.\n     *\n     * This will replace the existing action, if any, with a new action\n     * allowing the user to join or leave the group, depending on their\n     * current membership status.\n     */\n    _updateActions() {\n        if (this.get('joined')) {\n            this.actions = [{\n                id: 'leave',\n                label: gettext('Leave')\n            }];\n        } else {\n            this.actions = [{\n                id: 'join',\n                label: gettext('Join')\n            }];\n        }\n\n        this.trigger('actionsChanged');\n    }\n});\n\n\n/**\n * Provides UI for showing a group membership.\n *\n * This will display the group information and provide buttons for\n * the Join/Leave actions.\n */\nconst GroupMembershipItemView = Djblets.Config.ListItemView.extend({\n    actionHandlers: {\n        'join': '_onJoinClicked',\n        'leave': '_onLeaveClicked'\n    },\n\n    template: _.template([\n        '<span class=\"config-group-name\">',\n        ' <a href=\"<%- editURL %>\"><%- text %></a>',\n        '</span>',\n        '<span class=\"config-group-display-name\"><%- displayName %></span>'\n    ].join('')),\n\n    /**\n     * Handler for when Join is clicked.\n     *\n     * Tells the model to join the group.\n     */\n    _onJoinClicked() {\n        this.model.joinGroup();\n    },\n\n    /**\n     * Handler for when Leave is clicked.\n     *\n     * Tells the model to leave the group.\n     */\n    _onLeaveClicked() {\n        this.model.leaveGroup();\n    }\n});\n\n\n/**\n * Displays a list of group membership items, globally or for a Local Site.\n *\n * If displaying for a Local Site, then the name of the site will be shown\n * before the list.\n *\n * Each group in the list will be shown as an item with Join/Leave buttons.\n *\n * The list of groups are filterable. When filtering, if there are no groups\n * that match the filter, then the whole view will be hidden.\n */\nconst SiteGroupsView = Backbone.View.extend({\n    template: _.template(dedent`\n        <% if (name) { %>\n         <div class=\"djblets-l-config-forms-container\">\n          <h3><%- name %></h3>\n         </div>\n        <% } %>\n        <div class=\"groups\"></div>\n    `),\n\n    /**\n     * Initialize the view.\n     *\n     * This will create a list for all groups in this view.\n     *\n     * Args:\n     *     options (object):\n     *         Options for view construction.\n     *\n     * Option Args:\n     *     name (string):\n     *         The name of the local site, if any.\n     */\n    initialize(options) {\n        this.name = options.name;\n        this.collection = new RB.FilteredCollection(null, {\n            collection: new Backbone.Collection(options.groups, {\n                model: GroupMembershipItem\n            })\n        });\n        this.groupList = new Djblets.Config.List({}, {\n            collection: this.collection\n        });\n    },\n\n    /**\n     * Render the view.\n     *\n     * Returns:\n     *     SiteGroupsView:\n     *     This object, for chaining.\n     */\n    render() {\n        this._listView = new Djblets.Config.ListView({\n            ItemView: GroupMembershipItemView,\n            model: this.groupList\n        });\n\n        this.$el.html(this.template({\n            name: this.name\n        }));\n\n        this._listView.render();\n        this._listView.$el.appendTo(this.$('.groups'));\n\n        return this;\n    },\n\n    /**\n     * Filter the list of groups by name.\n     *\n     * If no groups are found, then the view will hide itself.\n     *\n     * Args:\n     *     name (string):\n     *         The group name to search for.\n     */\n    filterBy(name) {\n        this.collection.setFilters({\n            'name': name\n        });\n\n        this.$el.setVisible(this.collection.length > 0);\n    }\n});\n\n\n/**\n * Provides UI for managing a user's group memberships.\n *\n * All accessible groups will be shown to the user, sectioned by\n * Local Site. This list is filterable through a search box at the top of\n * the view.\n *\n * Each group entry provides a button for joining or leaving the group,\n * allowing users to manage their memberships.\n */\nRB.JoinedGroupsView = Backbone.View.extend({\n    template: _.template(dedent`\n        <div class=\"djblets-l-config-forms-container\">\n         <div class=\"rb-c-search-field\">\n          <span class=\"fa fa-search\"></span>\n          <input class=\"rb-c-search-field__input\" type=\"search\">\n         </div>\n        </div>\n        <div class=\"group-lists\"></div>\n    `),\n\n    events: {\n        'submit': '_onSubmit',\n        'keyup .rb-c-search-field__input': '_onGroupSearchChanged',\n        'change .rb-c-search-field__input': '_onGroupSearchChanged',\n    },\n\n    /*\n     * Initialize the view.\n     *\n     * Args:\n     *     options (object):\n     *         Options for view construction.\n     *\n     * Option Args:\n     *     groups (Array of object):\n     *         Initial set of groups.\n     */\n    initialize(options) {\n        this.groups = options.groups;\n\n        this._$listsContainer = null;\n        this._$search = null;\n        this._searchText = null;\n        this._groupViews = [];\n    },\n\n    /**\n     * Render the view.\n     *\n     * This will set up the elements and the list of SiteGroupsViews.\n     *\n     * Returns:\n     *     RB.JoinedGroupsView.\n     *     This object, for chaining.\n     */\n    render() {\n        this.$el.html(this.template());\n\n        this._$listsContainer = this.$('.group-lists');\n        this._$search = this.$('.rb-c-search-field__input');\n\n        for (let [localSiteName, groups] of Object.entries(this.groups)) {\n            if (groups.length > 0) {\n                const view = new SiteGroupsView({\n                    name: localSiteName,\n                    groups: groups\n                });\n\n                view.$el.appendTo(this._$listsContainer);\n                view.render();\n\n                this._groupViews.push(view);\n            }\n        }\n\n        return this;\n    },\n\n    /**\n     * Handler for when the search box changes.\n     *\n     * This will instruct the SiteGroupsViews to filter their contents\n     * by the text entered into the search box.\n     */\n    _onGroupSearchChanged() {\n        const text = this._$search.val();\n\n        if (text !== this._searchText) {\n            this._searchText = text;\n            this._groupViews.forEach(view => view.filterBy(this._searchText));\n        }\n    },\n\n    /**\n     * Prevent form submission.\n     *\n     * This form live updates based on the content of the <input> field and\n     * submitting it will result in a CSRF error.\n     *\n     * Args:\n     *     e (Event):\n     *         The form submission event.\n     */\n    _onSubmit(e) {\n        e.preventDefault();\n    }\n});\n\n\n})();\n"]}