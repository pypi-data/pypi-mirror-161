{"version":3,"sources":["infoboxManagerViewTests.es6.js"],"names":[],"mappings":"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","file":"infoboxManagerViewTests.js","sourcesContent":["suite('rb/ui/views/InfoboxManagerView', function() {\n    const DummyInfoboxView = RB.BaseInfoboxView.extend({\n        infoboxID: 'dummy-infobox',\n    });\n\n    let infoboxManagerView;\n\n    beforeEach(function() {\n        infoboxManagerView = RB.InfoboxManagerView.getInstance();\n\n        spyOn(infoboxManagerView, '_fetchInfoboxContents')\n            .and.callFake((url, onDone) => {\n                expect(url).toBe('/foo/infobox/');\n                onDone('<strong>Hi!</strong>');\n            });\n    });\n\n    afterEach(function() {\n        infoboxManagerView.remove();\n        RB.InfoboxManagerView._instance = null;\n    });\n\n    describe('addTargets', function() {\n        let $el1;\n        let $el2;\n        let $els;\n\n        beforeEach(function() {\n            $el1 = $('<div/>');\n            $el2 = $('<div/>');\n            $els = $([$el1[0], $el2[0]]);\n        });\n\n        it('Registers new targets', function() {\n            infoboxManagerView.addTargets(DummyInfoboxView, $els);\n\n            expect($el1.data('has-infobox')).toBe(true);\n            expect($el2.data('has-infobox')).toBe(true);\n        });\n\n        it('Registers event handlers', function() {\n            spyOn(infoboxManagerView, '_onTargetMouseEnter');\n            spyOn(infoboxManagerView, '_onMouseLeave');\n\n            infoboxManagerView.addTargets(DummyInfoboxView, $els);\n\n            $el1.triggerHandler('mouseenter');\n            expect(infoboxManagerView._onTargetMouseEnter).toHaveBeenCalled();\n\n            $el1.triggerHandler('mouseleave');\n            expect(infoboxManagerView._onMouseLeave).toHaveBeenCalled();\n        });\n\n        it('Skips already-registered targets', function() {\n            spyOn(infoboxManagerView, '_onTargetMouseEnter');\n\n            infoboxManagerView.addTargets(DummyInfoboxView, $els);\n            infoboxManagerView.addTargets(DummyInfoboxView, $els);\n\n            $el1.triggerHandler('mouseenter');\n            expect(infoboxManagerView._onTargetMouseEnter.calls.count())\n                .toBe(1);\n        });\n    });\n\n    describe('getOrCreateInfobox', function() {\n        it('Caches infobox views', function() {\n            const infoboxView1 = infoboxManagerView.getOrCreateInfobox(\n                DummyInfoboxView);\n            const infoboxView2 = infoboxManagerView.getOrCreateInfobox(\n                DummyInfoboxView);\n\n            expect(infoboxView1.cid).toBe(infoboxView2.cid);\n        });\n\n        it('Starts infobox hidden', function() {\n            const infoboxView = infoboxManagerView.getOrCreateInfobox(\n                DummyInfoboxView);\n\n            expect(infoboxView.$el.is(':visible')).toBe(false);\n        });\n\n        it('Registers events', function() {\n            spyOn(infoboxManagerView, '_onInfoboxMouseEnter');\n            spyOn(infoboxManagerView, '_onMouseLeave');\n\n            const infoboxView = infoboxManagerView.getOrCreateInfobox(\n                DummyInfoboxView);\n\n            infoboxView.$el.triggerHandler('mouseenter');\n            expect(infoboxManagerView._onInfoboxMouseEnter).toHaveBeenCalled();\n\n            infoboxView.$el.triggerHandler('mouseleave');\n            expect(infoboxManagerView._onMouseLeave).toHaveBeenCalled();\n        });\n    });\n\n    describe('setPositioning', function() {\n        it('Overrides default position', function() {\n            infoboxManagerView.setPositioning(DummyInfoboxView, {\n                side: 'b',\n                foo: 'bar',\n            });\n\n            const infoboxView = infoboxManagerView.getOrCreateInfobox(\n                DummyInfoboxView);\n            expect(infoboxView.positioning).toEqual({\n                side: 'b',\n                foo: 'bar',\n            });\n        });\n    });\n\n    describe('Target Events', function() {\n        let $el;\n\n        beforeEach(function() {\n            spyOn(window, 'setTimeout').and.callFake(cb => cb());\n\n            $el = $('<a href=\"/foo/\" />');\n            infoboxManagerView.addTargets(DummyInfoboxView, $el);\n        });\n\n        describe('mouseenter', function() {\n            it('First time for target', function() {\n                $el.triggerHandler('mouseenter');\n\n                const infoboxView = infoboxManagerView.getOrCreateInfobox(\n                    DummyInfoboxView);\n                expect(infoboxView.$el.html()).toBe('<strong>Hi!</strong>');\n                expect(infoboxView.$el.is(':visible')).toBe(true);\n            });\n\n            it('Subsequent time for target (cached data)', function() {\n                const infoboxView = infoboxManagerView.getOrCreateInfobox(\n                    DummyInfoboxView);\n\n                spyOn(infoboxView, 'setContents').and.callThrough();\n                spyOn(infoboxManagerView, '_showInfobox')\n                    .and.callThrough();\n\n                infoboxManagerView._cache['/foo/infobox/'] = 'Old HTML';\n\n                $el.triggerHandler('mouseenter');\n\n                expect(infoboxView.$el.html()).toBe('<strong>Hi!</strong>');\n                expect(infoboxView.$el.is(':visible')).toBe(true);\n                expect(infoboxManagerView._showInfobox.calls.count())\n                    .toBe(1);\n                expect(infoboxView.setContents.calls.count()).toBe(2);\n            });\n        });\n\n        describe('mouseleave', function() {\n            beforeEach(function() {\n                $el.triggerHandler('mouseenter');\n            });\n\n            it('Cancels showing infobox', function() {\n                infoboxManagerView._showTimeout = 123;\n\n                $el.triggerHandler('mouseleave');\n\n                expect(infoboxManagerView._showTimeout).toBe(null);\n            });\n\n            it('Hides infobox', function() {\n                const infoboxView = infoboxManagerView.getOrCreateInfobox(\n                    DummyInfoboxView);\n                infoboxManagerView._showTimeout = 123;\n\n                expect(infoboxView.$el.is(':visible')).toBe(true);\n                expect(infoboxManagerView._activeInfoboxView).not.toBe(null);\n\n                $el.triggerHandler('mouseleave');\n\n                expect(infoboxView.$el.is(':visible')).toBe(false);\n                expect(infoboxManagerView._activeInfoboxView).toBe(null);\n                expect(infoboxManagerView._showTimeout).toBe(null);\n            });\n        });\n    });\n\n    describe('Infobox Events', function() {\n        let $el;\n\n        beforeEach(function() {\n            spyOn(window, 'setTimeout').and.callFake(cb => cb());\n\n            $el = $('<a href=\"/foo/\" />');\n            infoboxManagerView.addTargets(DummyInfoboxView, $el);\n        });\n\n        describe('mouseenter', function() {\n            it('Preserves infobox after leaving target', function() {\n                const infoboxView = infoboxManagerView.getOrCreateInfobox(\n                    DummyInfoboxView);\n\n                /* Simulate hovering over a target. */\n                $el.triggerHandler('mouseenter');\n                expect(infoboxManagerView._activeInfoboxView)\n                    .toBe(infoboxView);\n\n                /*\n                 * Restore the default behavior of the spy and simulate the\n                 * mouse leaving the target.\n                 */\n                window.setTimeout.and.callThrough();\n                $el.triggerHandler('mouseleave');\n\n                expect(infoboxManagerView._hideTimeout).not.toBe(null);\n                expect(infoboxManagerView._showTimeout).toBe(null);\n\n                infoboxView.$el.triggerHandler('mouseenter');\n\n                expect(infoboxView.$el.is(':visible')).toBe(true);\n                expect(infoboxManagerView._showTimeout).toBe(null);\n                expect(infoboxManagerView._hideTimeout).toBe(null);\n            });\n        });\n\n        describe('mouseleave', function() {\n            it('Hides infobox', function() {\n                const infoboxView = infoboxManagerView.getOrCreateInfobox(\n                    DummyInfoboxView);\n\n                infoboxManagerView._showInfobox(infoboxView, $el);\n                expect(infoboxView.$el.is(':visible')).toBe(true);\n                expect(infoboxManagerView._activeInfoboxView)\n                    .toBe(infoboxView);\n\n                infoboxView.$el.triggerHandler('mouseleave');\n\n                expect(infoboxView.$el.is(':visible')).toBe(false);\n                expect(infoboxManagerView._activeInfoboxView).toBe(null);\n                expect(infoboxManagerView._showTimeout).toBe(null);\n            });\n        });\n    });\n});\n"]}