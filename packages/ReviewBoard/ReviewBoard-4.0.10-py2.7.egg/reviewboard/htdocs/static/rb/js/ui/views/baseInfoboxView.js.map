{"version":3,"sources":["baseInfoboxView.es6.js"],"names":[],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,CAAC,eAAH,GAAqB,QAAQ,CAAC,IAAT,CAAc,MAAd,CAAqB;EACtC;AACJ;AACA;AACA;AACA;EACI,SAAS,EAAE,IAN2B;EAQtC,mBAAmB,EAAE;IACjB,IAAI,EAAE,IADW;IAEjB,OAAO,EAAE,CAAC,EAFO;IAGjB,SAAS,EAAE;EAHM,CARiB;EActC,MAAM,EAAE;IACJ,yCAAyC,wBADrC;IAEJ,kCAAkC,wBAF9B;IAGJ,0CAA0C,yBAHtC;IAIJ,0CAA0C;EAJtC,CAd8B;;EAqBtC;AACJ;AACA;EACI,UAAU,GAAG;IACT;IACA,KAAK,WAAL,GAAmB,KAAK,mBAAxB;IAEA,KAAK,eAAL,GAAuB,IAAvB;EACH,CA7BqC;;EA+BtC;AACJ;AACA;AACA;AACA;AACA;AACA;EACI,SAAS,GAAG;IACR,yBAAkB,KAAK,SAAvB;EACH,CAxCqC;;EA0CtC;AACJ;AACA;AACA;AACA;AACA;EACI,eAAe,CAAC,OAAD,EAAU;IACrB,iBAAU,OAAO,CAAC,IAAR,CAAa,MAAb,CAAV;EACH,CAlDqC;;EAoDtC;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACI,WAAW,CAAC,IAAD,EAAO;IACd,KAAK,GAAL,CAAS,IAAT,CAAc,IAAd;IACA,KAAK,MAAL;EACH,CAjEqC;;EAmEtC;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACI,MAAM,GAAG;IACL;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACQ,KAAK,eAAL,GAAuB,IAAvB;IAEA,KAAK,GAAL,CACK,GADL,CACS,OADT,EACkB,EADlB,EAEK,IAFL,CAEU,6BAFV,EAGS,GAHT,CAGa,eAHb,EAG8B,KAAK,kBAAL,EAH9B;;IAKA,CAAC,CAAC,KAAF,CAAQ,MAAM,KAAK,GAAL,CAAS,KAAT,CAAe,KAAK,GAAL,CAAS,KAAT,EAAf,CAAd;;IAEA,OAAO,IAAP;EACH,CA3GqC;;EA6GtC;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACI,kBAAkB,GAAG;IACjB,IAAI,KAAK,eAAL,KAAyB,IAA7B,EAAmC;MAC/B,MAAM,GAAG,GAAG,CAAC,CAAC,iBAAD,CAAD,CACP,GADO,CACH;QACD,UAAU,EAAE,QADX;QAED,QAAQ,EAAE,UAFT;QAGD,IAAI,EAAE,CAAC,KAHN;QAID,GAAG,EAAE,CAAC;MAJL,CADG,EAOP,QAPO,CAOE,QAAQ,CAAC,IAPX,CAAZ;MAQA,MAAM,KAAK,GAAG,GAAG,CAAC,KAAJ,EAAd;MAEA,GAAG,CAAC,GAAJ,CAAQ,YAAR,EAAsB,QAAtB;MACA,MAAM,QAAQ,GAAG,GAAG,CAAC,KAAJ,EAAjB;MAEA,GAAG,CAAC,MAAJ;MAEA,KAAK,eAAL,GAAuB,QAAQ,GAAG,KAAlC;IACH;;IAED,OAAO,KAAK,eAAZ;EACH,CAjJqC;;EAmJtC;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACI,sBAAsB,CAAC,GAAD,EAAM;IACxB,CAAC,CAAC,GAAG,CAAC,MAAL,CAAD,CAAc,OAAd,CAAsB,qBAAtB,EACK,QADL,CACc,2BADd;EAEH,CA/JqC;;EAiKtC;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACI,sBAAsB,CAAC,GAAD,EAAM;IACxB,CAAC,CAAC,GAAG,CAAC,MAAL,CAAD,CAAc,OAAd,CAAsB,qBAAtB,EACK,WADL,CACiB,2BADjB;EAEH,CA7KqC;;EA+KtC;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACI,uBAAuB,CAAC,GAAD,EAAM;IACzB,CAAC,CAAC,GAAG,CAAC,MAAL,CAAD,CAAc,OAAd,CAAsB,6BAAtB,EACK,GADL,CACS,eADT,EAC0B,CAD1B;EAEH,CA3LqC;;EA6LtC;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACI,uBAAuB,CAAC,GAAD,EAAM;IACzB,CAAC,CAAC,GAAG,CAAC,MAAL,CAAD,CAAc,OAAd,CAAsB,6BAAtB,EACK,GADL,CACS,eADT,EAC0B,KAAK,kBAAL,EAD1B;EAEH;;AAzMqC,CAArB,CAArB","file":"baseInfoboxView.js","sourcesContent":["/**\n * An infobox pop-up.\n *\n * This binds to an ``<a>`` element (expected to be either a bug, a user, or a\n * review request right now), and loads the contents of the infobox from a URL\n * built from that element's ``href`` attribute plus the string \"infobox/\".\n */\nRB.BaseInfoboxView = Backbone.View.extend({\n    /**\n     * The unique ID for the infobox.\n     *\n     * This will also be used as the CSS class for the infobox.\n     */\n    infoboxID: null,\n\n    DEFAULT_POSITIONING: {\n        side: 'tb',\n        xOffset: -20,\n        yDistance: 10,\n    },\n\n    events: {\n        'mouseenter .infobox-hover-item-anchor': '_onHoverItemMouseEnter',\n        'mouseleave .infobox-hover-item': '_onHoverItemMouseLeave',\n        'mouseenter .infobox-scrollable-section': '_onScrollableMouseEnter',\n        'mouseleave .infobox-scrollable-section': '_onScrollableMouseLeave',\n    },\n\n    /**\n     * Initialize the infobox.\n     */\n    initialize() {\n        /* Set the default positioning. This can be overridden by pages. */\n        this.positioning = this.DEFAULT_POSITIONING;\n\n        this._scrollbarWidth = null;\n    },\n\n    /**\n     * Return the class name for the infobox.\n     *\n     * Returns:\n     *     string:\n     *     The CSS class name for the infobox element.\n     */\n    className() {\n        return `infobox ${this.infoboxID}`;\n    },\n\n    /**\n     * Return the infobox contents URL for a given target.\n     *\n     * By default, this uses the ``href`` argument on the target, appending\n     * ``infobox/``. Infoboxes can override this to provide a different URL.\n     */\n    getURLForTarget($target) {\n        return `${$target.attr('href')}infobox/`;\n    },\n\n    /**\n     * Set new contents for the infobox.\n     *\n     * This will replace the HTML of the infobox element and then cause\n     * :js:meth:`render` to be called.\n     *\n     * Args:\n     *     html (string):\n     *         The new HTML to set.\n     */\n    setContents(html) {\n        this.$el.html(html);\n        this.render();\n    },\n\n    /**\n     * Render the infobox.\n     *\n     * Subclasses can override this to provide specific rendering. By default,\n     * there's no custom rendering performed here.\n     *\n     * Subclasses should always call the parent method.\n     *\n     * Returns:\n     *     RB.BaseInfoboxView:\n     *     This infobox instance, for chaining.\n     */\n    render() {\n        /*\n         * We want to be smart about how the scrollbar is handled when\n         * hovering over scrollable sections. If we leave this up to CSS,\n         * the contents within will either get less space on hover, possibly\n         * wrapping (due to the scrollbars appearing), or the window will\n         * expand, potentially influencing other elements in the infobox.\n         * Neither are good.\n         *\n         * So what we do is compute the width of the scrollbar and reserve\n         * that much space to the right of the content. After we have that,\n         * we figure out the natural width for this infobox and then force\n         * that width so that the infobox can't unexpectedly widen.\n         *\n         * When hovering over the scrollable section, the additional padding\n         * will go away and the scrollbar will appear, ensuring that neither\n         * the content nor the window will alter in size.\n         */\n        this._scrollbarWidth = null;\n\n        this.$el\n            .css('width', '')\n            .find('.infobox-scrollable-section')\n                .css('padding-right', this._getScrollbarWidth());\n\n        _.defer(() => this.$el.width(this.$el.width()));\n\n        return this;\n    },\n\n    /**\n     * Return the width of the scrollbar.\n     *\n     * This will create a temporary off-screen element, measure its width,\n     * and then force the display of a scrollbar, and measure that. The\n     * difference in widths is the width of the scrollbar.\n     *\n     * This value may be 0, depending on how the browser renders scrollbars\n     * for content. macOS, by default, won't have any measurable width for the\n     * scrollbar.\n     *\n     * Returns:\n     *     number:\n     *     The width of the scrollbar.\n     */\n    _getScrollbarWidth() {\n        if (this._scrollbarWidth === null) {\n            const $el = $('<div>test</div>')\n                .css({\n                    visibility: 'hidden',\n                    position: 'absolute',\n                    left: -10000,\n                    top: -10000,\n                })\n                .appendTo(document.body);\n            const width = $el.width();\n\n            $el.css('overflow-y', 'scroll');\n            const newWidth = $el.width();\n\n            $el.remove();\n\n            this._scrollbarWidth = newWidth - width;\n        }\n\n        return this._scrollbarWidth;\n    },\n\n    /**\n     * Handler for mouseenter events on hover item anchors.\n     *\n     * This will display the hover details for the item.\n     *\n     * Args:\n     *     evt (Event):\n     *         The mouseenter event.\n     */\n    _onHoverItemMouseEnter(evt) {\n        $(evt.target).closest('.infobox-hover-item')\n            .addClass('infobox-hover-item-opened');\n    },\n\n    /**\n     * Handler for mouseleave events on hover items or their children.\n     *\n     * This will hide the hover details for the item.\n     *\n     * Args:\n     *     evt (Event):\n     *         The mouseleave event.\n     */\n    _onHoverItemMouseLeave(evt) {\n        $(evt.target).closest('.infobox-hover-item')\n            .removeClass('infobox-hover-item-opened');\n    },\n\n    /**\n     * Handler for mouseenter events on the description area.\n     *\n     * This will turn off the padding so the scrollbar has room.\n     *\n     * Args:\n     *     evt (Event):\n     *         The mouseenter event.\n     */\n    _onScrollableMouseEnter(evt) {\n        $(evt.target).closest('.infobox-scrollable-section')\n            .css('padding-right', 0);\n    },\n\n    /**\n     * Handler for mouseleave events on the description area.\n     *\n     * This will re-enable the padding where the scrollbar would be.\n     *\n     * Args:\n     *     evt (Event):\n     *         The mouseleave event.\n     */\n    _onScrollableMouseLeave(evt) {\n        $(evt.target).closest('.infobox-scrollable-section')\n            .css('padding-right', this._getScrollbarWidth());\n    },\n});\n"]}