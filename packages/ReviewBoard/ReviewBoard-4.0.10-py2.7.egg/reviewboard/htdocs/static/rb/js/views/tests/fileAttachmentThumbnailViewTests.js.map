{"version":3,"sources":["fileAttachmentThumbnailViewTests.es6.js"],"names":[],"mappings":"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","file":"fileAttachmentThumbnailViewTests.js","sourcesContent":["suite('rb/views/FileAttachmentThumbnail', function() {\n    let reviewRequest;\n    let model;\n    let view;\n\n    beforeEach(function() {\n        reviewRequest = new RB.ReviewRequest();\n        model = new RB.FileAttachment({\n            downloadURL: 'http://example.com/file.png',\n            filename: 'file.png',\n        });\n\n        spyOn(model, 'trigger').and.callThrough();\n    });\n\n    describe('Rendering', function() {\n        function expectElements() {\n            expect(view.$('a.edit').length).toBe(1);\n            expect(view.$('.file-caption').length).toBe(1);\n            expect(view.$('.file-actions').length).toBe(1);\n            expect(view.$('.file-delete').length).toBe(\n                view.options.canEdit && model.get('loaded') ? 1 : 0);\n            expect(view.$('.file-update').length).toBe(\n                view.options.canEdit && model.get('loaded') ? 1 : 0);\n        }\n\n        function expectAttributeMatches() {\n            expect(view.$('.file-download').attr('href')).toBe(\n                model.get('downloadURL'));\n            expect(view.$('.file-caption .edit').text()).toBe(\n                model.get('caption'));\n        }\n\n        it('Using existing elements', function() {\n            const $el = $('<div/>')\n                .addClass(RB.FileAttachmentThumbnail.prototype.className)\n                .html(RB.FileAttachmentThumbnail.prototype.template(\n                    _.defaults({\n                        caption: 'No caption',\n                        captionClass: 'edit empty-caption',\n                    }, model.attributes)));\n\n            model.set('loaded', true);\n\n            view = new RB.FileAttachmentThumbnail({\n                renderThumbnail: true,\n                reviewRequest: reviewRequest,\n                el: $el,\n                model: model,\n            });\n            $testsScratch.append(view.$el);\n            view.render();\n\n            expectElements();\n\n            expect(view.$('.file-actions').is(':visible')).toBe(true);\n            expect(view.$('.fa-spinner').length).toBe(0);\n        });\n\n        it('Rendered thumbnail with unloaded model', function() {\n            view = new RB.FileAttachmentThumbnail({\n                reviewRequest: reviewRequest,\n                renderThumbnail: true,\n                model: model,\n            });\n            $testsScratch.append(view.$el);\n            view.render();\n\n            expectElements();\n\n            expect(view.$('.file-actions').children().length).toBe(0);\n            expect(view.$('.fa-spinner').length).toBe(1);\n        });\n\n        describe('Rendered thumbnail with loaded model', function() {\n            beforeEach(function() {\n                model.id = 123;\n                model.attributes.id = 123;\n                model.set('caption', 'My Caption');\n                model.set('loaded', true);\n                model.url = '/api/file-attachments/123/';\n            });\n\n            it('With review UI', function() {\n                model.set('reviewURL', '/review/');\n\n                view = new RB.FileAttachmentThumbnail({\n                    reviewRequest: reviewRequest,\n                    renderThumbnail: true,\n                    model: model,\n                });\n                $testsScratch.append(view.$el);\n                view.render();\n\n                expectElements();\n                expectAttributeMatches();\n\n                expect(view.$('.file-actions').children().length).toBe(2);\n                expect(view.$('.fa-spinner').length).toBe(0);\n                expect(view.$('.file-review').length).toBe(1);\n                expect(view.$('.file-add-comment').length).toBe(0);\n            });\n\n            it('No review UI', function() {\n                view = new RB.FileAttachmentThumbnail({\n                    reviewRequest: reviewRequest,\n                    renderThumbnail: true,\n                    model: model,\n                });\n                $testsScratch.append(view.$el);\n                view.render();\n\n                expectElements();\n                expectAttributeMatches();\n\n                expect(view.$('.file-actions').children().length).toBe(2);\n                expect(view.$('.fa-spinner').length).toBe(0);\n                expect(view.$('.file-review').length).toBe(0);\n                expect(view.$('.file-add-comment').length).toBe(1);\n            });\n        });\n    });\n\n    describe('Actions', function() {\n        beforeEach(function() {\n            model.id = 123;\n            model.attributes.id = 123;\n            model.set('loaded', true);\n            model.url = '/api/file-attachments/123/';\n\n            view = new RB.FileAttachmentThumbnail({\n                canEdit: true,\n                reviewRequest: reviewRequest,\n                renderThumbnail: true,\n                model: model,\n            });\n            $testsScratch.append(view.$el);\n            view.render();\n\n            spyOn(view, 'trigger').and.callThrough();\n        });\n\n        it('Begin caption editing', function() {\n            view._captionEditorView.startEdit();\n            expect(view.trigger).toHaveBeenCalledWith('beginEdit');\n        });\n\n        it('Cancel caption editing', function() {\n            view._captionEditorView.startEdit();\n            expect(view.trigger).toHaveBeenCalledWith('beginEdit');\n\n            view._captionEditorView.cancel();\n            expect(view.trigger).toHaveBeenCalledWith('endEdit');\n        });\n\n        it('Save caption', function() {\n            spyOn(model, 'save');\n\n            view._captionEditorView.startEdit();\n            expect(view.trigger).toHaveBeenCalledWith('beginEdit');\n\n            view.$('input')\n                .val('Foo')\n                .triggerHandler('keyup');\n            view._captionEditorView.submit();\n\n            expect(view.trigger).toHaveBeenCalledWith('endEdit');\n            expect(model.get('caption')).toBe('Foo');\n            expect(model.save).toHaveBeenCalled();\n        });\n\n        it('Delete', function() {\n            spyOn(model, 'destroy').and.callThrough();\n            spyOn($, 'ajax').and.callFake(options => options.success());\n            spyOn(view.$el, 'fadeOut').and.callFake(done => done());\n            spyOn(view, 'remove');\n\n            view.$('.file-delete').click();\n\n            expect($.ajax).toHaveBeenCalled();\n            expect(model.destroy).toHaveBeenCalled();\n            expect(model.trigger.calls.argsFor(2)[0]).toBe('destroying');\n            expect(view.$el.fadeOut).toHaveBeenCalled();\n            expect(view.remove).toHaveBeenCalled();\n        });\n    });\n});\n"]}