{"version":3,"sources":["diffCommitListView.es6.js"],"names":[],"mappings":"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","file":"diffCommitListView.js","sourcesContent":["/*\n * The templates should be kept in sync with:\n *\n * - templates/reviews/changedesc_commit_list.html\n * - templates/reviews/commit_list_field.html\n *\n * so that they render items identically.\n */\n(function() {\n\n\nconst itemTemplate = _.template(dedent`\n    <tr<% if (rowClass) { %> class=\"<%- rowClass %>\"<% } %>>\n     <% if (showHistorySymbol) { %>\n      <td class=\"marker\">\n       <%- historyDiffEntry.getSymbol() %>\n      </td>\n     <% } else if (showInterCommitDiffControls) { %>\n      <td class=\"select-base\">\n       <input type=\"radio\"\n              class=\"base-commit-selector\"\n              name=\"base-commit-id\"\n              <% if (baseSelected) { %>checked<% } %>\n              <% if (baseDisabled) { %>disabled<% } %>\n              value=\"<%- commit.id %>\">\n      </td>\n      <td class=\"select-tip\">\n       <input type=\"radio\"\n              class=\"tip-commit-selector\"\n              name=\"tip-commit-id\"\n              <% if (tipSelected) { %>checked<% } %>\n              <% if (tipDisabled) { %>disabled<% } %>\n              value=\"<%- commit.id %>\">\n      </td>\n     <% } %>\n     <% if (showExpandCollapse) { %>\n      <td>\n       <% if (commit && commit.hasSummary()) { %>\n        <a href=\"#\"\n           class=\"expand-commit-message\"\n           data-commit-id=\"<%- commit.id %>\"\n           aria-role=\"button\">\n         <span class=\"fa fa-plus\" title=\"<%- expandText %>\"></span>\n        </a>\n       <% } %>\n      </td>\n     <% } %>\n     <td<% if (showHistorySymbol) { %> class=\"value\"<% } %>>\n      <% if (commit !== null) { %>\n       <pre><%- commit.get('summary') %></pre>\n      <% } %>\n     </td>\n     <td<% if (showHistorySymbol) { %> class=\"value\"<% } %>>\n      <% if (commit !== null) { %>\n       <%- commit.get('authorName') %>\n      <% } %>\n     </td>\n    </tr>\n`);\n\nconst headerTemplate = _.template(dedent`\n    <thead>\n     <tr>\n      <% if (showHistorySymbol) { %>\n       <th></th>\n      <% } else if (showInterCommitDiffControls) { %>\n       <th><%- firstText %></th>\n       <th><%- lastText %></th>\n      <% } %>\n      <th<% if (showExpandCollapse) { %> colspan=\"2\"<% } %>>\n       <%- summaryText %>\n       </th>\n      <th><%- authorText %></th>\n     </tr>\n    </thead>\n`);\n\nconst tableTemplate = _.template(dedent`\n    <form>\n     <table class=\"commit-list\">\n      <colgroup>\n       <% if (showHistorySymbol) { %>\n        <col>\n       <% } else if (showInterCommitDiffControls) { %>\n         <col>\n         <col>\n       <% } %>\n       <% if (showExpandCollapse) { %>\n        <col class=\"expand-collapse-control\">\n       <% } %>\n       <col>\n       <col>\n      </colgroup>\n     </table>\n    </form>\n`);\n\n/**\n * A view for displaying a list of commits and their metadata.\n */\nRB.DiffCommitListView = Backbone.View.extend({\n    events: {\n        'change .base-commit-selector': '_onBaseChanged',\n        'change .tip-commit-selector': '_onTipChanged',\n        'click .collapse-commit-message': '_collapseCommitMessage',\n        'click .expand-commit-message': '_expandCommitMessage',\n    },\n\n    /**\n     * Initialize the view.\n     *\n     * Args:\n     *     options (object):\n     *         Options that control how this view behaves.\n     *\n     * Option Args:\n     *     showInterCommitDiffControls (boolean):\n     *         Whether or not to show interdiff controls.\n     */\n    initialize(options) {\n        this.listenTo(this.model.get('commits'), 'reset', this.render);\n\n        this._showInterCommitDiffControls =\n            !!options.showInterCommitDiffControls;\n\n        this._$baseSelectors = $();\n        this._$tipSelectors = $();\n    },\n\n    /**\n     * Render the view.\n     *\n     * Returns:\n     *     RB.DiffCommitListView:\n     *     This view, for chaining.\n     */\n    render() {\n        const commits = this.model.get('commits');\n        const isInterdiff = this.model.isInterdiff();\n\n        const commonContext = {\n            showExpandCollapse: commits.some(commit => commit.hasSummary()),\n            showHistorySymbol: isInterdiff,\n            showInterCommitDiffControls:\n                this._showInterCommitDiffControls,\n        };\n\n        const $content = $(tableTemplate(commonContext))\n        const $table = $content\n            .find('table')\n            .toggleClass('changed', isInterdiff)\n            .append(headerTemplate(_.extend(\n                {\n                    authorText: gettext('Author'),\n                    firstText: gettext('First'),\n                    lastText: gettext('Last'),\n                    summaryText: gettext('Summary'),\n                },\n                commonContext\n            )));\n\n        const $tbody = $('<tbody />');\n\n        commonContext.expandText = gettext('Expand commit message.');\n\n        if (isInterdiff) {\n            this.model.get('historyDiff').each(historyDiffEntry => {\n                const entryType = historyDiffEntry.get('entryType');\n\n                let key;\n                let rowClass;\n\n                switch (entryType) {\n                    case RB.CommitHistoryDiffEntry.ADDED:\n                        rowClass = 'new-value';\n                        key = 'newCommitID';\n                        break;\n\n                    case RB.CommitHistoryDiffEntry.REMOVED:\n                        rowClass = 'old-value';\n                        key = 'oldCommitID';\n                        break;\n\n                    case RB.CommitHistoryDiffEntry.UNMODIFIED:\n                    case RB.CommitHistoryDiffEntry.MODIFIED:\n                        key = 'newCommitID';\n                        break;\n\n                    default:\n                        console.error('Invalid history entry type: %s',\n                                      entryType);\n                        break;\n                }\n\n                const commit = commits.get(historyDiffEntry.get(key));\n\n                $tbody.append(itemTemplate(_.extend(\n                    {\n                        commit: commit,\n                        historyDiffEntry: historyDiffEntry,\n                        rowClass: rowClass,\n                    },\n                    commonContext\n                )));\n            });\n        } else {\n            commonContext.rowClass = '';\n\n            const baseCommitID = this.model.get('baseCommitID');\n            const tipCommitID = this.model.get('tipCommitID');\n            const lastIndex = commits.size() - 1;\n\n            const baseIndex = (\n                baseCommitID === null\n                ? 0\n                : commits.indexOf(commits.getChild(commits.get(baseCommitID)))\n            );\n\n            const tipIndex = (tipCommitID === null\n                              ? lastIndex\n                              : commits.indexOf(commits.get(tipCommitID)));\n\n            commits.each((commit, i) => {\n                $tbody.append(itemTemplate(_.extend(\n                    {\n                        commit: commit,\n                        baseSelected: i === baseIndex,\n                        tipSelected: i === tipIndex,\n                        baseDisabled: i > tipIndex,\n                        tipDisabled: i < baseIndex,\n                    },\n                    commonContext\n                )));\n            });\n        }\n\n        $table.append($tbody);\n\n        this.$el\n            .empty()\n            .append($content);\n\n        this._$baseSelectors = this.$('.base-commit-selector');\n        this._$tipSelectors = this.$('.tip-commit-selector');\n\n        return this;\n    },\n\n    /**\n     * Handle the expand button being clicked.\n     *\n     * Args:\n     *     e (jQuery.Event):\n     *         The click event.\n     */\n    _expandCommitMessage(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        this._expandOrCollapse(\n            $(e.target).closest('.expand-commit-message'),\n            true);\n    },\n\n    /**\n     * Handle the collapse button being clicked.\n     *\n     * Args:\n     *     e (jQuery.Event):\n     *         The click event.\n     */\n    _collapseCommitMessage(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        this._expandOrCollapse(\n            $(e.target).closest('.collapse-commit-message'),\n            false);\n    },\n\n    /**\n     * Expand or collapse the commit message on the same row as the link.\n     *\n     * Args:\n     *     $link (jQuery):\n     *         The expand or collapse link that was clicked.\n     *\n     *     expand (boolean):\n     *         Whether we are expanding (``true``) or collapsing (``false``).\n     */\n    _expandOrCollapse($link, expand) {\n        const $icon = $link.find('.fa');\n        const commitID = $link.data('commitId');\n\n        const commit = this.model.get('commits').get(commitID);\n        const newText = commit.get(expand ? 'commitMessage' : 'summary');\n\n        $link.closest('tr')\n            .find('pre')\n            .text(newText);\n\n        $link.attr(\n            'class',\n            expand ? 'collapse-commit-message' : 'expand-commit-message');\n\n        $icon.attr({\n            'class': expand ? 'fa fa-minus' : 'fa fa-plus',\n            'title': expand ? gettext('Collapse commit message.')\n                            : gettext('Expand commit message.'),\n        });\n    },\n\n    /**\n     * Handle the base commit selection changing.\n     *\n     * The view's model will be updated to reflect this change.\n     *\n     * Args:\n     *     e (jQuery.Event):\n     *         The change event.\n     */\n    _onBaseChanged(e) {\n        const $target = $(e.target);\n        const commits = this.model.get('commits');\n        const commit = commits.get(parseInt($target.val(), 10));\n        const index = commits.indexOf(commit);\n\n        this.model.set('baseCommitID',\n                       index === 0\n                       ? null\n                       : commits.getParent(commit).id);\n\n        this._$tipSelectors\n            .slice(0, index)\n            .prop('disabled', true);\n\n        this._$tipSelectors\n            .slice(index)\n            .prop('disabled', false);\n    },\n\n    /**\n     * Handle the tip commit selection changing.\n     *\n     * The view's model will be updated to reflect this change.\n     *\n     * Args:\n     *     e (jQuery.Event):\n     *         The change event.\n     */\n    _onTipChanged(e) {\n        const $target = $(e.target);\n        const commits = this.model.get('commits');\n        const commit = commits.get(parseInt($target.val(), 10));\n        const index = commits.indexOf(commit);\n\n        this.model.set('tipCommitID',\n                       index === commits.size() - 1\n                       ? null\n                       : commit.id);\n\n        this._$baseSelectors\n            .slice(0, index + 1)\n            .prop('disabled', false);\n\n        this._$baseSelectors\n            .slice(index + 1)\n            .prop('disabled', true);\n    },\n});\n\n\n})();\n"]}