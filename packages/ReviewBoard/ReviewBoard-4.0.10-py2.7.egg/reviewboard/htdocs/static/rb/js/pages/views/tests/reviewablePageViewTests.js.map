{"version":3,"sources":["reviewablePageViewTests.es6.js"],"names":[],"mappings":"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","file":"reviewablePageViewTests.js","sourcesContent":["suite('rb/pages/views/ReviewablePageView', function() {\n    const pageTemplate = dedent`\n        <div id=\"review-banner\"></div>\n        <a href=\"#\" id=\"review-action\">Edit Review</a>\n        <a href=\"#\" id=\"ship-it-action\">Ship It</a>\n    `;\n\n    let $editReview;\n    let $shipIt;\n    let page;\n    let pageView;\n\n    beforeEach(function() {\n        const $container = $('<div/>')\n            .html(pageTemplate)\n            .appendTo($testsScratch);\n\n        RB.DnDUploader.instance = null;\n\n        $editReview = $container.find('#review-action');\n        $shipIt = $container.find('#ship-it-action');\n\n        page = new RB.ReviewablePage({\n            checkForUpdates: false,\n            reviewRequestData: {\n                id: 123,\n                loaded: true,\n                state: RB.ReviewRequest.PENDING,\n            },\n            editorData: {\n                mutableByUser: true,\n                statusMutableByUser: true,\n            },\n        }, {\n            parse: true,\n        });\n\n        pageView = new RB.ReviewablePageView({\n            el: $container,\n            model: page,\n        });\n\n        const reviewRequest = page.get('reviewRequest');\n\n        spyOn(reviewRequest, 'ready').and.callFake(\n            (options, context) => options.ready.call(context));\n\n        pageView.render();\n    });\n\n    afterEach(function() {\n        RB.DnDUploader.instance = null;\n\n        pageView.remove();\n    });\n\n    describe('Public objects', function() {\n        it('reviewRequest', function() {\n            expect(page.get('reviewRequest')).not.toBe(undefined);\n        });\n\n        it('pendingReview', function() {\n            const pendingReview = page.get('pendingReview');\n\n            expect(pendingReview).not.toBe(undefined);\n            expect(pendingReview.get('parentObject'))\n                .toBe(page.get('reviewRequest'));\n        });\n\n        it('commentIssueManager', function() {\n            expect(page.commentIssueManager).not.toBe(undefined);\n            expect(page.commentIssueManager.get('reviewRequest'))\n                .toBe(page.get('reviewRequest'));\n        });\n\n        it('reviewRequestEditor', function() {\n            const reviewRequestEditor = page.reviewRequestEditor;\n\n            expect(reviewRequestEditor).not.toBe(undefined);\n            expect(reviewRequestEditor.get('reviewRequest'))\n                .toBe(page.get('reviewRequest'));\n            expect(reviewRequestEditor.get('commentIssueManager'))\n                .toBe(page.commentIssueManager);\n            expect(reviewRequestEditor.get('editable')).toBe(true);\n        });\n\n        it('reviewRequestEditorView', function() {\n            expect(pageView.reviewRequestEditorView).not.toBe(undefined);\n            expect(pageView.reviewRequestEditorView.model)\n                .toBe(page.reviewRequestEditor);\n        });\n    });\n\n    describe('Actions', function() {\n        it('Edit Review', function() {\n            spyOn(RB.ReviewDialogView, 'create');\n\n            $editReview.click();\n\n            expect(RB.ReviewDialogView.create).toHaveBeenCalled();\n\n            const options = RB.ReviewDialogView.create.calls.argsFor(0)[0];\n            expect(options.review).toBe(page.get('pendingReview'));\n            expect(options.reviewRequestEditor).toBe(page.reviewRequestEditor);\n        });\n\n        describe('Ship It', function() {\n            let pendingReview;\n\n            beforeEach(function() {\n                pendingReview = page.get('pendingReview');\n            });\n\n            it('Confirmed', function() {\n                spyOn(window, 'confirm').and.returnValue(true);\n                spyOn(pendingReview, 'ready').and.callFake(\n                    (options, context) => options.ready.call(context));\n                spyOn(pendingReview, 'save').and.callFake(\n                    (options, context) => options.success.call(context));\n                spyOn(pendingReview, 'publish').and.callThrough();\n                spyOn(pageView.draftReviewBanner, 'hideAndReload');\n\n                $shipIt.click();\n\n                expect(window.confirm).toHaveBeenCalled();\n                expect(pendingReview.ready).toHaveBeenCalled();\n                expect(pendingReview.publish).toHaveBeenCalled();\n                expect(pendingReview.save).toHaveBeenCalled();\n                expect(pageView.draftReviewBanner.hideAndReload)\n                    .toHaveBeenCalled();\n                expect(pendingReview.get('shipIt')).toBe(true);\n                expect(pendingReview.get('bodyTop')).toBe('Ship It!');\n            });\n\n            it('Canceled', function() {\n                spyOn(window, 'confirm').and.returnValue(false);\n                spyOn(pendingReview, 'ready');\n\n                $shipIt.click();\n\n                expect(window.confirm).toHaveBeenCalled();\n                expect(pendingReview.ready).not.toHaveBeenCalled();\n            });\n        });\n    });\n\n    describe('Update bubble', function() {\n        const summary = 'My summary';\n        const user = {\n            url: '/users/foo/',\n            fullname: 'Mr. User',\n            username: 'user',\n        };\n        let $bubble;\n        let bubbleView;\n\n        beforeEach(function() {\n            page.get('reviewRequest').trigger('updated', {\n                summary: summary,\n                user: user,\n            });\n\n            $bubble = $('#updates-bubble');\n            bubbleView = pageView._updatesBubble;\n        });\n\n        it('Displays', function() {\n            expect($bubble.length).toBe(1);\n            expect(bubbleView.$el[0]).toBe($bubble[0]);\n            expect($bubble.is(':visible')).toBe(true);\n            expect($bubble.find('#updates-bubble-summary').text())\n                .toBe(summary);\n            expect($bubble.find('#updates-bubble-user').text())\n                .toBe(user.fullname);\n            expect($bubble.find('#updates-bubble-user').attr('href'))\n                .toBe(user.url);\n        });\n\n        describe('Actions', function() {\n            it('Ignore', function() {\n                spyOn(bubbleView, 'close').and.callThrough();\n                spyOn(bubbleView, 'trigger').and.callThrough();\n                spyOn(bubbleView, 'remove').and.callThrough();\n\n                $bubble.find('.ignore').click();\n\n                expect(bubbleView.close).toHaveBeenCalled();\n                expect(bubbleView.remove).toHaveBeenCalled();\n                expect(bubbleView.trigger).toHaveBeenCalledWith('closed');\n            });\n\n            it('Update Page displays Updates Bubble', function() {\n                spyOn(bubbleView, 'trigger');\n\n                $bubble.find('.update-page').click();\n\n                expect(bubbleView.trigger).toHaveBeenCalledWith('updatePage');\n            });\n\n            it('Update Page calls notify if shouldNotify', function() {\n                const info = {\n                    user: {\n                        fullname: 'Hello',\n                    },\n                };\n\n                RB.NotificationManager.instance._canNotify = true;\n                spyOn(RB.NotificationManager.instance, 'notify');\n                spyOn(RB.NotificationManager.instance,\n                      '_haveNotificationPermissions').and.returnValue(true);\n                spyOn(pageView, '_showUpdatesBubble');\n\n                pageView._onReviewRequestUpdated(info);\n\n                expect(RB.NotificationManager.instance.notify)\n                    .toHaveBeenCalled();\n                expect(pageView._showUpdatesBubble).toHaveBeenCalled();\n            });\n        });\n    });\n});\n"]}