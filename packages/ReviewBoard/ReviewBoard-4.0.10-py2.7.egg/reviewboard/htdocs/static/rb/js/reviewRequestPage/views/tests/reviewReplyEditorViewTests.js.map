{"version":3,"sources":["reviewReplyEditorViewTests.es6.js"],"names":[],"mappings":"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","file":"reviewReplyEditorViewTests.js","sourcesContent":["suite('rb/reviewRequestPage/views/ReviewReplyEditorView', function() {\n    let reviewReply;\n    let editor;\n    let view;\n\n    beforeEach(function() {\n        const $container = $('<div/>').appendTo($testsScratch);\n\n        reviewReply = new RB.ReviewReply({\n            id: 121\n        });\n\n        /* Some tests will invoke this, so just pretend it works. */\n        spyOn(reviewReply, 'discardIfEmpty').and.callFake(\n            (options, context) => options.success.call(context));\n\n        editor = new RB.ReviewRequestPage.ReviewReplyEditor({\n            anchorPrefix: 'header-reply',\n            replyObject: reviewReply,\n            review: new RB.Review({\n                id: 42,\n                parentObject: new RB.ReviewRequest(),\n            }),\n            reviewReply: reviewReply,\n            contextType: 'rcbt',\n            contextID: '100',\n        });\n\n        view = new RB.ReviewRequestPage.ReviewReplyEditorView({\n            model: editor,\n            el: $testsScratch,\n        });\n\n        /* Necessary to do pre-render so we can use makeCommentElement. */\n        view._$commentsList = $('<ul class=\"reply-comments\"/>');\n\n        $container\n            .append(view._$commentsList)\n            .append($('<a href=\"#\" class=\"add_comment_link\">New Comment</a>'));\n    });\n\n    describe('Construction', function() {\n        it('Populate from draft comment', function() {\n            const commentText = 'Test comment';\n            const now = moment();\n            const $el = view._makeCommentElement({\n                commentID: 16,\n                now: now,\n                text: commentText,\n            });\n\n            view.render();\n\n            expect(editor.get('commentID')).toBe(16);\n            expect(editor.get('text')).toBe(commentText);\n            expect(editor.get('hasDraft')).toBe(true);\n            expect(editor.get('timestamp').valueOf())\n                .toBe(now.milliseconds(0).valueOf());\n            expect(view._$draftComment[0]).toBe($el[0]);\n            expect(view._$addCommentLink.is(':visible')).toBe(false);\n        });\n    });\n\n    describe('Actions', function() {\n        it('Add comment link', function() {\n            view.render();\n\n            expect(view._$addCommentLink.is(':visible')).toBe(true);\n            view._$addCommentLink.click();\n\n            expect(view._$addCommentLink.is(':visible')).toBe(false);\n            expect(view._$draftComment).not.toBe(null);\n            expect(view._$draftComment.hasClass('draft')).toBe(true);\n        });\n    });\n\n    describe('Event handling', function() {\n        it('Comment discarded', function() {\n            view._makeCommentElement({\n                text: 'Test comment',\n            });\n\n            view.render();\n\n            let $el = view.$('.reply-comments li');\n            expect($el.length).toBe(1);\n\n            reviewReply.trigger('destroyed');\n\n            $el = view.$('.reply-comments li');\n            expect($el.length).toBe(0);\n            expect(view._$draftComment).toBe(null);\n        });\n\n        it('Comment published', function() {\n            const $draftEl = view._makeCommentElement({\n                commentID: 16,\n            });\n\n            spyOn($.fn, 'user_infobox').and.callThrough();\n            spyOn($.fn, 'timesince').and.callThrough();\n\n            view.render();\n            editor.set('text', 'Test **comment**');\n            reviewReply.trigger('published');\n\n            const $el = view.$('.reply-comments li');\n\n            expect($el.length).toBe(1);\n            expect($draftEl).not.toBe($el);\n            expect($el.hasClass('draft')).toBe(false);\n            expect($el.data('comment-id')).toBe(16);\n            expect(view._$draftComment).toBe(null);\n            expect($.fn.user_infobox).toHaveBeenCalled();\n            expect($.fn.timesince).toHaveBeenCalled();\n\n            const $anchor = $el.children('.comment-anchor');\n            expect($anchor.length).toBe(1);\n            expect($anchor.attr('name')).toBe('header-reply121');\n\n            const $floatingAnchor = $el.find('> .floating-anchor > a');\n            expect($floatingAnchor.length).toBe(1);\n            expect($floatingAnchor.attr('href')).toBe('#header-reply121');\n            expect($floatingAnchor.hasClass('fa fa-link fa-flip-horizontal'))\n                .toBe(true);\n        });\n    });\n\n    describe('Methods', function() {\n        it('openCommentEditor', function() {\n            view.render();\n\n            expect(view._$addCommentLink.is(':visible')).toBe(true);\n            expect(view._$draftComment).toBe(null);\n\n            view.openCommentEditor();\n\n            expect(view._$addCommentLink.is(':visible')).toBe(false);\n            expect(view._$draftComment).not.toBe(null);\n            expect(view._$draftComment.hasClass('draft')).toBe(true);\n        });\n    });\n\n    describe('Text rendering', function() {\n        function testRendering(richText, expectedHTML) {\n            view.render();\n\n            const $comment = view._makeCommentElement({\n                text: '<p><strong>Test</strong> &amp;lt;</p>',\n                richText: richText,\n            });\n\n            const $reviewText = $comment.find('.reviewtext');\n            expect($reviewText.length).toBe(1);\n            expect($reviewText.hasClass('rich-text')).toBe(richText);\n            expect($reviewText.html()).toBe(expectedHTML);\n        }\n\n        it('richText=true', function() {\n            testRendering(true, '<p><strong>Test</strong> &amp;lt;</p>');\n        });\n\n        it('richText=false', function() {\n            testRendering(false,\n                          '&lt;p&gt;&lt;strong&gt;Test&lt;/strong&gt; ' +\n                          '&amp;amp;lt;&lt;/p&gt;');\n        });\n    });\n});\n"]}