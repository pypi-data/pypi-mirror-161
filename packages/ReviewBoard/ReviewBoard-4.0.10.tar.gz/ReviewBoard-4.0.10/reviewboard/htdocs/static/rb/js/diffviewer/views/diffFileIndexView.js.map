{"version":3,"sources":["diffFileIndexView.es6.js"],"names":[],"mappings":"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","file":"diffFileIndexView.js","sourcesContent":["/**\n * Displays the file index for the diffs on a page.\n *\n * The file page lists the names of the files, as well as a little graph\n * icon showing the relative size and complexity of a file, a list of chunks\n * (and their types), and the number of lines added and removed.\n */\nRB.DiffFileIndexView = Backbone.View.extend({\n    chunkTemplate: _.template(\n        '<a href=\"#<%= chunkID %>\" class=\"<%= className %>\"> </a>'\n    ),\n\n    _itemTemplate: _.template(dedent`\n        <tr class=\"loading\n         <% if (newfile) { %>new-file<% } %>\n         <% if (binary) { %>binary-file<% } %>\n         <% if (deleted) { %>deleted-file<% } %>\n         <% if (destFilename !== depotFilename) { %>renamed-file<% } %>\n         \">\n         <td class=\"diff-file-icon\">\n          <span class=\"fa fa-spinner fa-pulse\"></span>\n         </td>\n         <td class=\"diff-file-info\">\n          <a href=\"#<%- index %>\"><%- destFilename %></a>\n          <% if (destFilename !== depotFilename) { %>\n          <span class=\"diff-file-rename\"><%- wasText %></span>\n          <% } %>\n         </td>\n         <td class=\"diff-chunks-cell\">\n          <% if (binary) { %>\n           <%- binaryFileText %>\n          <% } else if (deleted) { %>\n           <%- deletedFileText %>\n          <% } else { %>\n           <div class=\"diff-chunks\"></div>\n          <% } %>\n         </td>\n        </tr>\n    `),\n\n    events: {\n        'click a': '_onAnchorClicked',\n    },\n\n    /**\n     * Initialize the view.\n     *\n     * Args:\n     *     options (object):\n     *         Options for the view.\n     *\n     * Option Args:\n     *     collection (RB.DiffFileCollection):\n     *         The collection containing the files.\n     */\n    initialize(options) {\n        this.options = options;\n        this._$items = null;\n        this._$itemsTable = null;\n\n        this.collection = this.options.collection;\n        this.listenTo(this.collection, 'reset update', this.update);\n    },\n\n    /**\n     * Render the view to the page.\n     *\n     * Returns:\n     *     RB.DiffFileIndexView:\n     *     This object, for chaining.\n     */\n    render() {\n        this.$el.empty();\n\n        this._$itemsTable = $('<table/>').appendTo(this.$el);\n        this._$items = this.$('tr');\n\n        // Add the files from the collection\n        this.update();\n\n        return this;\n    },\n\n    /**\n     * Update the list of files in the index view.\n     */\n    update() {\n        this._$itemsTable.empty();\n\n        this.collection.each(file => {\n            this._$itemsTable.append(this._itemTemplate(\n                _.defaults({\n                    binaryFileText: gettext('Binary file'),\n                    deletedFileText: gettext('Deleted'),\n                    wasText: interpolate(gettext('Was %s'),\n                                         [file.get('depotFilename')]),\n                }, file.attributes)\n            ));\n        });\n\n        this._$items = this.$('tr');\n    },\n\n    /**\n     * Add a loaded diff to the index.\n     *\n     * The reserved entry for the diff will be populated with a link to the\n     * diff, and information about the diff.\n     *\n     * Args:\n     *     index (number):\n     *         The array index at which to add the new diff.\n     *\n     *     diffReviewableView (RB.DiffReviewableView):\n     *         The view corresponding to the diff file being added.\n     */\n    addDiff(index, diffReviewableView) {\n        const $item = $(this._$items[index])\n            .removeClass('loading');\n\n        if (diffReviewableView.$el.hasClass('diff-error')) {\n            this._renderDiffError($item);\n        } else {\n            this._renderDiffEntry($item, diffReviewableView);\n        }\n    },\n\n    /**\n     * Render a diff loading error.\n     *\n     * An error icon will be displayed in place of the typical complexity\n     * icon.\n     *\n     * Args:\n     *     $item (jQuery):\n     *         The item in the file index which encountered the error.\n     */\n    _renderDiffError($item) {\n        $item.find('.diff-file-icon')\n            .html('<div class=\"rb-icon rb-icon-warning\" />')\n            .attr('title',\n                  gettext('There was an error loading this diff. See the details below.'));\n    },\n\n    /**\n     * Render the display of a loaded diff.\n     *\n     * Args:\n     *     $item (jQuery):\n     *         The item in the file index which was loaded.\n     *\n     *     diffReviewableView (RB.DiffReviewableView):\n     *         The view corresponding to the diff file which was loaded.\n     */\n    _renderDiffEntry($item, diffReviewableView) {\n        const $table = diffReviewableView.$el;\n        const fileDeleted = $item.hasClass('deleted-file');\n        const fileAdded = $item.hasClass('new-file');\n        const linesEqual = $table.data('lines-equal');\n        let numDeletes = 0;\n        let numInserts = 0;\n        let numReplaces = 0;\n        let tooltip = '';\n        const tooltipParts = [];\n        const chunksList = [];\n\n        if (fileAdded) {\n            numInserts = 1;\n        } else if (fileDeleted) {\n            numDeletes = 1;\n        } else if ($item.hasClass('binary-file')) {\n            numReplaces = 1;\n        } else {\n            $table.children('tbody').each((i, chunk) => {\n                const numRows = chunk.rows.length;\n                const $chunk = $(chunk);\n\n                if ($chunk.hasClass('delete')) {\n                    numDeletes += numRows;\n                } else if ($chunk.hasClass('insert')) {\n                    numInserts += numRows;\n                } else if ($chunk.hasClass('replace')) {\n                    numReplaces += numRows;\n                } else {\n                    return;\n                }\n\n                chunksList.push(this.chunkTemplate({\n                    chunkID: chunk.id.substr(5),\n                    className: chunk.className,\n                }));\n            });\n\n            /* Add clickable blocks for each diff chunk. */\n            $item.find('.diff-chunks').html(chunksList.join(''));\n        }\n\n        /* Render the complexity icon. */\n        const iconView = new RB.DiffComplexityIconView({\n            numInserts: numInserts,\n            numDeletes: numDeletes,\n            numReplaces: numReplaces,\n            totalLines: linesEqual + numDeletes + numInserts + numReplaces,\n        });\n\n        const $fileIcon = $item.find('.diff-file-icon');\n        $fileIcon\n            .empty()\n            .append(iconView.$el);\n\n        iconView.render();\n\n        /* Add tooltip for icon */\n        if (fileAdded) {\n            tooltip = gettext('New file');\n        } else if (fileDeleted) {\n            tooltip = gettext('Deleted file');\n        } else {\n            if (numInserts > 0) {\n                tooltipParts.push(interpolate(\n                    ngettext('%s new line', '%s new lines', numInserts),\n                    [numInserts]));\n            }\n\n            if (numReplaces > 0) {\n                tooltipParts.push(interpolate(\n                    ngettext('%s line changed', '%s lines changed', numReplaces),\n                    [numReplaces]));\n            }\n\n            if (numDeletes > 0) {\n                tooltipParts.push(interpolate(\n                    ngettext('%s line removed', '%s lines removed', numDeletes),\n                    [numDeletes]));\n            }\n\n            tooltip = tooltipParts.join(', ');\n        }\n\n        $fileIcon.attr('title', tooltip);\n\n        this.listenTo(\n            diffReviewableView,\n            'chunkDimmed chunkUndimmed',\n            chunkID => {\n                this.$(`a[href=\"#${chunkID}\"]`).toggleClass('dimmed');\n            });\n    },\n\n    /**\n     * Handler for when an anchor is clicked.\n     *\n     * Gets the name of the target and emits anchorClicked.\n     *\n     * Args:\n     *     e (Event):\n     *         The click event.\n     */\n    _onAnchorClicked: function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        this.trigger('anchorClicked', e.target.href.split('#')[1]);\n    },\n});\n"]}