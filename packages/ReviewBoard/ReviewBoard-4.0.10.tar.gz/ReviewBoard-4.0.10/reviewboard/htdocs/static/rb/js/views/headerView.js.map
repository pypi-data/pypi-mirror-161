{"version":3,"sources":["headerView.es6.js"],"names":[],"mappings":"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","file":"headerView.js","sourcesContent":["/**\n * Site Header\n */\nRB.HeaderView = Backbone.View.extend({\n    SEARCH_SUMMARY_TRIM_LEN: 28,\n    DESKTOP_SEARCH_RESULTS_WIDTH: 350,\n\n    events: {\n        'click #nav_toggle': '_handleNavClick',\n        'touchstart #nav_toggle': '_handleNavClick',\n        'focus #search_field': '_closeMobileMenu',\n    },\n\n    /**\n     * Initialize the header.\n     *\n     * Args:\n     *     options (object, optional):\n     *         Options for the view.\n     *\n     * Option Args:\n     *     $body (jQuery, optional):\n     *         The body element. This is useful for unit tests.\n     *\n     *     $pageSidebar (jQuery, optional):\n     *         The page sidebar element. This is useful for unit tests.\n     */\n    initialize(options={}) {\n        if (RB.HeaderView.instance !== null) {\n            console.warn('There are two instances of RB.HeaderView on the ' +\n                         'page. Make sure only one RB.PageView is ' +\n                         'instantiated and registered through ' +\n                         'RB.PageManager.setupPage().');\n        } else {\n            RB.HeaderView.instance = this;\n        }\n\n        this.options = options;\n\n        /*\n         * This is used by RB.PageManager to determine if a RB.PageView\n         * subclass has correctly rendered a HeaderView, or if PageManager\n         * needs to take care of it.\n         *\n         * This is deprecated and can be removed in Review Board 5.0.\n         */\n        this.isRendered = false;\n\n        this._mobileMenuOpened = false;\n\n        this._$window = null;\n        this._$body = null;\n        this._$navToggle = null;\n        this._$mobileMenuMask = null;\n    },\n\n    /**\n     * Remove the view from the DOM and disable event handling.\n     *\n     * This will also unset :js:attr:`RB.HeaderView.instance`, if currently\n     * set to this instance.\n     */\n    remove() {\n        if (RB.HeaderView.instance === this) {\n            RB.HeaderView.instance = null;\n        }\n\n        if (this._$window) {\n            this._$window.off('resize.rbHeaderView');\n        }\n\n        Backbone.View.prototype.remove.call(this);\n    },\n\n    /**\n     * Render the header.\n     *\n     * Returns:\n     *     RB.HeaderView:\n     *     This view, for chaining.\n     */\n    render() {\n        const options = this.options;\n\n        this._$window = $(window);\n        this._$body = options.body || $(document.body);\n        this._$navToggle = $('#nav_toggle');\n        this._$mobileMenuMask = $('<div id=\"mobile_menu_mask\"/>')\n            .on('click touchstart', this._closeMobileMenu.bind(this))\n            .insertAfter(options.$pageSidebar || $('#page-sidebar'));\n\n        this._$window.on('resize.rbHeaderView', _.throttle(\n            this._recalcMobileMode.bind(this),\n            100));\n        this._recalcMobileMode();\n\n        this._setupSearch();\n\n        this.isRendered = true;\n\n        return this;\n    },\n\n    /**\n     * Handle a click on the mobile navigation menu.\n     *\n     * Args:\n     *     e (Event):\n     *         The click event.\n     */\n    _handleNavClick(e) {\n        e.stopPropagation();\n        e.preventDefault();\n\n        this._setMobileMenuOpened(!this._mobileMenuOpened);\n    },\n\n    /**\n     * Recalculate whether the header and nav menu is in mobile mode.\n     */\n    _recalcMobileMode() {\n        const inMobileMode = this._$navToggle.is(':visible');\n\n        if (inMobileMode === this.inMobileMode) {\n            return;\n        }\n\n        if (!inMobileMode) {\n            this._setMobileMenuOpened(false);\n        }\n\n        this.inMobileMode = inMobileMode;\n        this.trigger('mobileModeChanged', inMobileMode);\n    },\n\n    /**\n     * Close the mobile menu.\n     *\n     * This is used as an event handler, to make it easy to close the\n     * mobile menu and prevent any bubbling or default actions from the\n     * event.\n     */\n    _closeMobileMenu() {\n        this._setMobileMenuOpened(false);\n\n        return false;\n    },\n\n    /**\n     * Set up the search auto-complete field.\n     */\n    _setupSearch() {\n        this._$search = $('#search_field').rbautocomplete({\n            formatItem: data => {\n                let s;\n\n                if (data.username) {\n                    // For the format of users:\n                    s = data.username;\n\n                    if (data.fullname) {\n                        s += ` <span>(${_.escape(data.fullname)})</span>`;\n                    }\n\n                } else if (data.name) {\n                    // For the format of groups:\n                    const displayName = _.escape(data.display_name);\n                    s = `${data.name} <span>(${displayName})</span>`;\n                } else if (data.summary) {\n                    // For the format of review requests:\n                    if (data.summary.length < this.SEARCH_SUMMARY_TRIM_LEN) {\n                        s = data.summary;\n                    } else {\n                        s = data.summary.substring(\n                            0, this.SEARCH_SUMMARY_TRIM_LEN);\n                    }\n\n                    s += ` <span>(${_.escape(data.id)})</span>`;\n                }\n\n                return s;\n            },\n            matchCase: false,\n            multiple: false,\n            clickToURL: true,\n            selectFirst: false,\n            width: this.DESKTOP_SEARCH_RESULTS_WIDTH,\n            enterToURL: true,\n            resultsParentEl: $('#page-container'),\n            resultsClass: 'ui-autocomplete-results search-results',\n            parse: data => {\n                const objects = ['users', 'groups', 'review_requests'];\n                const keys = ['username', 'name', 'summary'];\n\n                const parsed = [];\n\n                for (let j = 0; j < objects.length; j++) {\n                    const object = objects[j];\n                    const items = data.search[object];\n\n                    for (let i = 0; i < items.length; i++) {\n                        const value = items[i];\n                        const key = keys[j];\n\n\n                        if (j !== 2) {\n                            // For users and groups, always show.\n                            parsed.push({\n                                data: value,\n                                value: value[key],\n                                result: value[key],\n                            });\n                        } else if (value.public) {\n                            /*\n                             * For review requests, only show ones that are\n                             * public.\n                             */\n                            parsed.push({\n                                data: value,\n                                value: value[key],\n                                result: value[key],\n                            });\n                        }\n                    }\n                }\n\n                return parsed;\n            },\n            url: `${SITE_ROOT}api/search/`,\n        });\n    },\n\n    /**\n     * Set whether the mobile menu is opened.\n     *\n     * Args:\n     *     opened (boolean):\n     *         Whether the menu is open.\n     */\n    _setMobileMenuOpened(opened) {\n        if (opened === this._mobileMenuOpened) {\n            return;\n        }\n\n        if (opened) {\n            this._$mobileMenuMask.show();\n            _.defer(() => this._$body.addClass('js-mobile-menu-open'));\n        } else {\n            this._$body.removeClass('js-mobile-menu-open');\n            _.delay(() => this._$mobileMenuMask.hide(), 300);\n        }\n\n        this._mobileMenuOpened = opened;\n    },\n}, {\n    /** The instance of the HeaderView. */\n    instance: null,\n});\n"]}