{"version":3,"sources":["chunkHighlighterView.es6.js"],"names":[],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,CAAC,oBAAH,GAA0B,QAAQ,CAAC,IAAT,CAAc,MAAd,CAAqB;EAC3C,SAAS,EAAE,gBADgC;;EAG3C;AACJ;AACA;EACI,UAAU,GAAG;IACT,KAAK,QAAL,GAAgB,IAAhB;IACA,KAAK,iBAAL,GAAyB,IAAzB;IACA,KAAK,eAAL,GAAuB,IAAvB;IACA,KAAK,QAAL,GAAgB,CAAC,CAAC,MAAD,CAAjB;IACA,KAAK,gBAAL,GAAwB,IAAxB;IACA,KAAK,QAAL,GAAgB,IAAhB;IACA,KAAK,WAAL,GAAmB,IAAnB;;IAEA,CAAC,CAAC,OAAF,CAAU,IAAV,EAAgB,cAAhB;EACH,CAhB0C;;EAkB3C;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACI,MAAM,GAAG;IACL,KAAK,QAAL,CAAc,EAAd,CAAiB,YAAY,KAAK,GAAlC,EAAuC,MAAM;MACzC,MAAM,WAAW,GAAG,KAAK,QAAL,CAAc,KAAd,EAApB;;MAEA,IAAI,WAAW,KAAK,KAAK,gBAAzB,EAA2C;QACvC,KAAK,gBAAL,GAAwB,WAAxB;QAEA,KAAK,YAAL;MACH;IACJ,CARD;;IAUA,KAAK,eAAL,GAAuB,CAAC,CAAC,iBAAD,CAAxB;IAEA,KAAK,YAAL;IAEA,OAAO,IAAP;EACH,CA5C0C;;EA8C3C;AACJ;AACA;EACI,MAAM,GAAG;IACL,QAAQ,CAAC,IAAT,CAAc,SAAd,CAAwB,MAAxB,CAA+B,IAA/B,CAAoC,IAApC;;IAEA,KAAK,QAAL,CAAc,GAAd,CAAkB,KAAK,GAAvB;EACH,CArD0C;;EAuD3C;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACI,SAAS,CAAC,MAAD,EAAS;IACd,KAAK,QAAL,GAAgB,MAAM,CAAC,CAAD,CAAtB;IACA,KAAK,iBAAL,GAAyB,MAAM,CAAC,OAAP,CAAe,iBAAf,EAAkC,CAAlC,CAAzB;IAEA,KAAK,YAAL;EACH,CAtE0C;;EAwE3C;AACJ;AACA;EACI,YAAY,GAAG;IACX,MAAM,OAAO,GAAG,KAAK,QAArB;;IAEA,IAAI,CAAC,OAAL,EAAc;MACV;IACH;;IAED,IAAI,OAAO,GAAG,KAAd;IACA,MAAM,GAAG,GAAG,EAAZ;IAEA;AACR;AACA;AACA;AACA;AACA;;IACQ,MAAM,GAAG,GAAG,IAAI,CAAC,KAAL,CAAW,OAAO,CAAC,SAAR,GACA,KAAK,iBAAL,CAAuB,SADvB,GACmC,CAD9C,CAAZ;IAEA,MAAM,MAAM,GAAG,OAAO,CAAC,YAAR,GAAuB,CAAtC;;IAEA,IAAI,GAAG,KAAK,KAAK,QAAjB,EAA2B;MACvB,GAAG,CAAC,GAAJ,GAAU,GAAV;MACA,KAAK,QAAL,GAAgB,GAAhB;MACA,OAAO,GAAG,IAAV;IACH;;IAED,IAAI,MAAM,KAAK,KAAK,WAApB,EAAiC;MAC7B,GAAG,CAAC,MAAJ,GAAa,MAAb;MACA,KAAK,WAAL,GAAmB,MAAnB;MACA,OAAO,GAAG,IAAV;IACH;;IAED,IAAI,OAAJ,EAAa;MACT;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;MACY,MAAM,OAAO,GAAG,KAAK,eAAL,CAAqB,UAArB,CAAgC,GAAhC,EAAqC,GAArC,CAAhB;;MACA,GAAG,CAAC,IAAJ,GAAW,CAAC,OAAZ;MACA,GAAG,CAAC,KAAJ,GAAY,CAAC,OAAb;MAEA,KAAK,GAAL,CAAS,GAAT,CAAa,GAAb;IACH;EACJ;;AA3H0C,CAArB,CAA1B","file":"chunkHighlighterView.js","sourcesContent":["/**\n * Highlights a chunk of the diff.\n *\n * This will create and move four border elements around the chunk. We use\n * these border elements instead of setting a border since few browsers\n * render borders on <tbody> tags the same, and give us few options for\n * styling.\n *\n * In practice, there's only ever one highlighter on a page at a time.\n */\nRB.ChunkHighlighterView = Backbone.View.extend({\n    className: 'diff-highlight',\n\n    /**\n     * Initialize the highlighter.\n     */\n    initialize() {\n        this._chunkEl = null;\n        this._chunkContainerEl = null;\n        this._$pageContainer = null;\n        this._$window = $(window);\n        this._prevWindowWidth = null;\n        this._prevTop = null;\n        this._prevHeight = null;\n\n        _.bindAll(this, 'updateLayout');\n    },\n\n    /**\n     * Render the highlighter to the page.\n     *\n     * This will create all the border elements and compute any variables\n     * we want to keep around for further rendering.\n     *\n     * Returns:\n     *     RB.ChunkHighlighterView:\n     *     This object, for chaining.\n     */\n    render() {\n        this._$window.on('resize.' + this.cid, () => {\n            const windowWidth = this._$window.width();\n\n            if (windowWidth !== this._prevWindowWidth) {\n                this._prevWindowWidth = windowWidth;\n\n                this.updateLayout();\n            }\n        });\n\n        this._$pageContainer = $('#page-container');\n\n        this.updateLayout();\n\n        return this;\n    },\n\n    /**\n     * Remove the highlighter from the page and disconnects all events.\n     */\n    remove() {\n        Backbone.View.prototype.remove.call(this);\n\n        this._$window.off(this.cid);\n    },\n\n    /**\n     * Highlight a new chunk element.\n     *\n     * The borders will surround the chunk element and track its position\n     * and size as the page updates.\n     *\n     * Args:\n     *     $chunk (jQuery):\n     *         The chunk element to highlight.\n     */\n    highlight($chunk) {\n        this._chunkEl = $chunk[0];\n        this._chunkContainerEl = $chunk.parents('.diff-container')[0];\n\n        this.updateLayout();\n    },\n\n    /**\n     * Update of the position of the highlighter.\n     */\n    updateLayout() {\n        const chunkEl = this._chunkEl;\n\n        if (!chunkEl) {\n            return;\n        }\n\n        let changed = false;\n        const css = {};\n\n        /*\n         * NOTE: We're hard-coding the border widths (1px) so we don't have to\n         *       look them up. The borders aren't directly on the chunk (and\n         *       may not even be on a child of this chunk), and it's a bit\n         *       slow to look these up.\n         */\n        const top = Math.floor(chunkEl.offsetTop +\n                               this._chunkContainerEl.offsetTop + 1);\n        const height = chunkEl.clientHeight + 1;\n\n        if (top !== this._prevTop) {\n            css.top = top;\n            this._prevTop = top;\n            changed = true;\n        }\n\n        if (height !== this._prevHeight) {\n            css.height = height;\n            this._prevHeight = height;\n            changed = true;\n        }\n\n        if (changed) {\n            /*\n             * If the positions of the chunk changed, then it's possible the\n             * page container's padding has also changed (zooming in/out), so\n             * be safe and recompute.\n             *\n             * Technically we should compute separately for the left and right\n             * sides, but in practice we apply even spacing. Save a\n             * calculation, since this happens in resize events.\n             */\n            const padding = this._$pageContainer.getExtents('p', 'l');\n            css.left = -padding;\n            css.right = -padding;\n\n            this.$el.css(css);\n        }\n    },\n});\n"]}