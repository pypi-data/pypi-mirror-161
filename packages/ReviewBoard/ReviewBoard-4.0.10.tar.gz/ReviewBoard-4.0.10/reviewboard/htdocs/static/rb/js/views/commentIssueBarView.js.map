{"version":3,"sources":["commentIssueBarView.es6.js"],"names":[],"mappings":"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","file":"commentIssueBarView.js","sourcesContent":["/**\n * Manages a comment's issue status bar.\n *\n * The buttons on the bar will update the comment's issue status on the server\n * when clicked. The bar will update to reflect the issue status of any\n * comments tracked by the issue summary table.\n */\nRB.CommentIssueBarView = Backbone.View.extend({\n    events: {\n        'click .reopen': '_onReopenClicked',\n        'click .resolve': '_onFixedClicked',\n        'click .drop': '_onDropClicked',\n        'click .verify-dropped': '_onVerifyDroppedClicked',\n        'click .verify-resolved': '_onVerifyFixedClicked',\n    },\n\n    statusInfo: {\n        open: {\n            visibleButtons: ['.drop', '.resolve'],\n            text: gettext('An issue was opened.'),\n        },\n        resolved: {\n            visibleButtons: ['.reopen'],\n            text: gettext('The issue has been resolved.'),\n        },\n        dropped: {\n            visibleButtons: ['.reopen'],\n            text: gettext('The issue has been dropped.'),\n        },\n        'verifying-dropped': {\n            visibleButtons: ['.reopen'],\n            text: gettext('Waiting for verification before dropping...'),\n        },\n        'verifying-resolved': {\n            visibleButtons: ['.reopen'],\n            text: gettext('Waiting for verification before resolving...'),\n        },\n    },\n\n    template: _.template(dedent`\n        <div class=\"issue-state\">\n         <div class=\"issue-container\">\n          <span class=\"rb-icon\"></span>\n          <span class=\"issue-details\">\n           <span class=\"issue-message\"></span>\n           <% if (interactive) { %>\n            <span class=\"issue-actions\">\n             <input type=\"button\" class=\"issue-button resolve\"\n                    value=\"<%- fixedLabel %>\">\n             <input type=\"button\" class=\"issue-button drop\"\n                    value=\"<%- dropLabel %>\">\n             <input type=\"button\" class=\"issue-button reopen\"\n                    value=\"<%- reopenLabel %>\">\n             <input type=\"button\" class=\"issue-button verify-resolved\"\n                    value=\"<%- verifyFixedLabel %>\">\n             <input type=\"button\" class=\"issue-button verify-dropped\"\n                    value=\"<%- verifyDroppedLabel %>\">\n            </span>\n           <% } %>\n          </span>\n         </div>\n        </div>\n    `),\n\n    /**\n     * Initialize the view.\n     *\n     * Args:\n     *     options (object):\n     *         Options for the view.\n     *\n     * Option Args:\n     *     canVerify (boolean):\n     *         Whether the user has permission to verify issues that require\n     *         it.\n     *\n     *     commentID (number):\n     *         The ID of the comment object.\n     *\n     *     commentIssueManager (RB.CommentIssueManager):\n     *         The issue manager.\n     *\n     *     commentType (string):\n     *         The type of comment being modified.\n     *\n     *     interactive (boolean):\n     *         Whether the comment issue bar is interactive or not.\n     *\n     *     issueStatus (string):\n     *         The current issue status.\n     *\n     *     reviewID (number):\n     *         The ID of the review that the comment is on.\n     */\n    initialize(options) {\n        this.options = options;\n\n        const page = RB.PageManager.getPage();\n\n        this._manager = (this.options.commentIssueManager ||\n                         page.model.commentIssueManager);\n        this._issueStatus = this.options.issueStatus;\n        this._$buttons = null;\n        this._$state = null;\n        this._$icon = null;\n        this._$message = null;\n    },\n\n    /**\n     * Render the issue status bar.\n     *\n     * Returns:\n     *     RB.CommentIssueBarView:\n     *     This object, for chaining.\n     */\n    render() {\n        if (this.$el.children().length === 0) {\n            this.$el.append(this.template({\n                interactive: this.options.interactive,\n                fixedLabel: gettext('Fixed'),\n                dropLabel: gettext('Drop'),\n                reopenLabel: gettext('Re-open'),\n                verifyDroppedLabel: gettext('Verify Dropped'),\n                verifyFixedLabel: gettext('Verify Fixed'),\n            }));\n        }\n\n        this._$buttons = this.$('.issue-button');\n        this._$state = this.$('.issue-state');\n        this._$icon = this.$('.rb-icon');\n        this._$message = this.$('.issue-message');\n\n        this._manager.on('issueStatusUpdated',\n                         this._onIssueStatusUpdated,\n                         this);\n        this._showStatus(this._issueStatus);\n\n        return this;\n    },\n\n    /**\n     * Set the issue status of the comment on the server.\n     *\n     * Args:\n     *     issueStatus (string):\n     *         The new issue status (one of ``open``, ``resolved``, or\n     *         ``dropped``).\n     */\n    _setStatus(issueStatus) {\n        this._$buttons.prop('disabled', true);\n        this._manager.setCommentState(this.options.reviewID,\n                                      this.options.commentID,\n                                      this.options.commentType,\n                                      issueStatus);\n    },\n\n    /**\n     * Show the current issue status of the comment.\n     *\n     * This will affect the button visibility and the text of the bar.\n     *\n     * Args:\n     *     issueStatus (string):\n     *         The issue status to show (one of ``open``, ``resolved``, or\n     *         ``dropped``).\n     */\n    _showStatus(issueStatus) {\n        const statusInfo = this.statusInfo[issueStatus];\n        const prevStatus = this._issueStatus;\n\n        this._issueStatus = issueStatus;\n\n        this._$state\n            .removeClass(prevStatus)\n            .addClass(issueStatus);\n\n        let iconClass;\n\n        if (issueStatus === RB.BaseComment.STATE_VERIFYING_DROPPED ||\n            issueStatus === RB.BaseComment.STATE_VERIFYING_RESOLVED) {\n            iconClass = 'rb-icon rb-icon-issue-verifying';\n        } else {\n            iconClass = `rb-icon rb-icon-issue-${issueStatus}`;\n        }\n\n        this._$icon.attr('class', iconClass);\n        this._$buttons.hide();\n        this._$message.text(statusInfo.text);\n\n        if (this.options.interactive) {\n            let visibleButtons = statusInfo.visibleButtons;\n\n            if (this.options.canVerify) {\n                if (issueStatus === RB.BaseComment.STATE_VERIFYING_DROPPED) {\n                    visibleButtons.push('.verify-dropped');\n                } else if (issueStatus ===\n                           RB.BaseComment.STATE_VERIFYING_RESOLVED) {\n                    visibleButtons.push('.verify-resolved');\n                }\n            }\n\n            this._$buttons.filter(visibleButtons.join(',')).show();\n            this._$buttons.prop('disabled', false);\n        }\n\n        this.trigger('statusChanged', prevStatus, issueStatus);\n    },\n\n    /**\n     * Handler for when \"Re-open\" is clicked.\n     *\n     * Reopens the issue.\n     */\n    _onReopenClicked() {\n        this._setStatus(RB.BaseComment.STATE_OPEN);\n    },\n\n    /**\n     * Handler for when \"Fixed\" is clicked.\n     *\n     * Marks the issue as fixed.\n     */\n    _onFixedClicked() {\n        const comment = this._manager.getComment(this.options.reviewID,\n                                                 this.options.commentID,\n                                                 this.options.commentType);\n\n        comment.ready({\n            ready: () => {\n                if (comment.requiresVerification() &&\n                    comment.getAuthorUsername() !==\n                        RB.UserSession.instance.get('username')) {\n                    this._setStatus(RB.BaseComment.STATE_VERIFYING_RESOLVED);\n                } else {\n                    this._setStatus(RB.BaseComment.STATE_RESOLVED);\n                }\n            },\n        });\n    },\n\n    /**\n     * Handler for when \"Drop\" is clicked.\n     *\n     * Marks the issue as dropped.\n     */\n    _onDropClicked() {\n        const comment = this._manager.getComment(this.options.reviewID,\n                                                 this.options.commentID,\n                                                 this.options.commentType);\n\n        comment.ready({\n            ready: () => {\n                if (comment.requiresVerification() &&\n                    comment.getAuthorUsername() !==\n                        RB.UserSession.instance.get('username')) {\n                    this._setStatus(RB.BaseComment.STATE_VERIFYING_DROPPED);\n                } else {\n                    this._setStatus(RB.BaseComment.STATE_DROPPED);\n                }\n            },\n        });\n    },\n\n    /**\n     * Handler for when \"Verify Fixed\" is clicked.\n     */\n    _onVerifyFixedClicked() {\n        this._setStatus(RB.BaseComment.STATE_RESOLVED);\n    },\n\n    /**\n     * Handler for when \"Verify Dropped\" is clicked.\n     */\n    _onVerifyDroppedClicked() {\n        this._setStatus(RB.BaseComment.STATE_DROPPED);\n    },\n\n    /**\n     * Handler for when the issue status for the comment changes.\n     *\n     * Updates the display to reflect the issue's current status.\n     *\n     * Args:\n     *     comment (RB.BaseComment):\n     *         The comment model that was updated.\n     *\n     *     oldIssueStatus (string, unused):\n     *         The old issue status.\n     *\n     *     timestamp (string, unused):\n     *         The timestamp of the update.\n     *\n     *     commentType (string):\n     *         The comment type that was updated.\n     *\n     *         Version Added:\n     *             4.0.8\n     */\n    _onIssueStatusUpdated(comment, oldIssueStatus, timestamp, commentType) {\n        const options = this.options;\n\n        if (comment.id === options.commentID &&\n            commentType === options.commentType) {\n            this._showStatus(comment.get('issueStatus'));\n        }\n    },\n});\n"]}