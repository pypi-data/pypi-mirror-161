{"version":3,"sources":["uploadAttachmentViewTests.es6.js"],"names":[],"mappings":"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","file":"uploadAttachmentViewTests.js","sourcesContent":["suite('rb/views/UploadAttachmentView', function() {\n    let reviewRequest;\n\n    beforeEach(function() {\n        reviewRequest = new RB.ReviewRequest({\n            summary: 'My Review Request',\n            reviewURL: '/r/1/',\n        });\n    });\n\n    describe('Instances', function() {\n        let dialog;\n\n        afterEach(function() {\n            if (dialog) {\n                dialog.hide();\n                dialog = null;\n            }\n        });\n\n        describe('Buttons', function() {\n            beforeEach(function() {\n                dialog = new RB.UploadAttachmentView({\n                    reviewRequest: reviewRequest,\n                });\n            });\n\n            describe('Cancel', function() {\n                let $button;\n\n                beforeEach(function() {\n                    dialog.show();\n                    $button = dialog.$buttonsMap.cancel;\n\n                    expect($button.length).toBe(1);\n                });\n\n                it('Enabled by default', function() {\n                    expect($button.is(':disabled')).toBe(false);\n                });\n\n                it('Closes dialog when clicked', function() {\n                    spyOn($.fn, 'modalBox').and.callThrough();\n                    dialog.delegateEvents();\n\n                    $button.click();\n                    expect($.fn.modalBox).toHaveBeenCalledWith('destroy');\n                });\n            });\n\n            describe('Upload', function() {\n                let $button;\n                let $path;\n\n                beforeEach(function() {\n                    spyOn(dialog, 'send');\n\n                    dialog.show();\n                    $button = dialog.$buttonsMap.upload;\n                    $path = dialog._$path;\n\n                    /*\n                     * Allows the value of the input to be changed\n                     * programmatically without security issues.\n                     */\n                    $path.attr('type', 'text');\n\n                    spyOn(dialog, 'updateUploadButtonEnabledState')\n                        .and.callThrough();\n                    dialog.delegateEvents();\n\n                    expect($button.length).toBe(1);\n                });\n\n                it('Disabled by default until a file is uploaded', function() {\n                    expect($button.is(':disabled')).toBe(true);\n                });\n\n                it('Enabled when a file is uploaded', function() {\n                    expect($button.is(':disabled')).toBe(true);\n\n                    $path\n                        .val('fakefile')\n                        .trigger('change');\n\n                    expect(dialog.updateUploadButtonEnabledState)\n                        .toHaveBeenCalledTimes(1);\n                    expect($button.is(':disabled')).toBe(false);\n                });\n\n                it('Disabled when an uploaded file is removed', function() {\n                    $path\n                        .val('fakefile')\n                        .trigger('change')\n                        .val('')\n                        .trigger('change');\n\n                    expect(dialog.updateUploadButtonEnabledState)\n                        .toHaveBeenCalledTimes(2);\n                    expect($button.is(':disabled')).toBe(true);\n                });\n\n                it('Uploads the file attachment', function() {\n                    expect($button.is(':disabled')).toBe(true);\n\n                    $path\n                        .val('fakefile')\n                        .trigger('change');\n\n                    expect(dialog.updateUploadButtonEnabledState).toHaveBeenCalled();\n                    expect($button.is(':disabled')).toBe(false);\n\n                    $button.click();\n                    expect(dialog.send).toHaveBeenCalled();\n                });\n            });\n        });\n\n        it('Dialog for updating an existing file attachment', function() {\n            dialog = new RB.UploadAttachmentView({\n                attachmentHistoryID: 14,\n                presetCaption: 'fakecaption',\n                reviewRequest: reviewRequest,\n            });\n\n            dialog.show();\n            const $caption = dialog.$('[name=\"caption\"]');\n            const $attachmentHistory = dialog.$('[name=\"attachment_history\"]');\n\n            expect($caption.length).toBe(1);\n            expect($caption.val()).toBe('fakecaption');\n\n            expect($attachmentHistory.length).toBe(1);\n            expect($attachmentHistory.val()).toBe('14');\n        });\n    });\n});\n"]}