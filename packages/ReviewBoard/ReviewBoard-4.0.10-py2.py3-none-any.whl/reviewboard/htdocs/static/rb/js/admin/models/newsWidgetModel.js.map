{"version":3,"sources":["newsWidgetModel.es6.js"],"names":[],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,CAAC,KAAH,CAAS,UAAT,GAAsB,EAAE,CAAC,KAAH,CAAS,MAAT,CAAgB,MAAhB,CAAuB;EACzC,QAAQ,EAAE,CAAC,CAAC,QAAF,CAAW;IACjB,QAAQ,EAAE,CADO;IAEjB,SAAS,EAAE,IAFM;IAGjB,OAAO,EAAE,IAHQ;IAIjB,MAAM,EAAE,IAJS;IAKjB,YAAY,EAAE;EALG,CAAX,EAMP,EAAE,CAAC,KAAH,CAAS,MAAT,CAAgB,SAAhB,CAA0B,QANnB,CAD+B;;EASzC;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACI,QAAQ,GAAG;IACP,KAAK,OAAL,CAAa,aAAb;IAEA,CAAC,CAAC,IAAF,CAAO,KAAK,GAAL,CAAS,QAAT,CAAP,EAA2B;MACvB,OAAO,EAAE;QACL,GAAG,EAAE;MADA,CADc;MAIvB,QAAQ,EAAE,KAJa;MAKvB,OAAO,EAAE,IAAI,IAAI;QACb,MAAM,QAAQ,GAAG,KAAK,GAAL,CAAS,UAAT,CAAjB;QACA,MAAM,MAAM,GAAG,CAAC,CAAC,IAAD,CAAD,CAAQ,IAAR,mBAAwB,QAAxB,OAAf;QAEA,KAAK,GAAL,CAAS,WAAT,EAAsB,CAAC,CAAC,GAAF,CAAM,MAAN,EAAc,IAAI,IAAI;UACxC,MAAM,KAAK,GAAG,CAAC,CAAC,IAAD,CAAf;UAEA,OAAO;YACH,IAAI,EAAE,MAAM,CAAC,KAAK,CAAC,IAAN,CAAW,SAAX,EAAsB,IAAtB,EAAD,EACC,8BADD,CADT;YAGH,KAAK,EAAE,KAAK,CAAC,IAAN,CAAW,OAAX,EAAoB,IAApB,EAHJ;YAIH,GAAG,EAAE,KAAK,CAAC,IAAN,CAAW,MAAX,EAAmB,IAAnB;UAJF,CAAP;QAMH,CATqB,CAAtB;MAUH,CAnBsB;MAoBvB,KAAK,EAAE,MAAM;QACT,KAAK,GAAL,CAAS,WAAT,EAAsB,EAAtB;MACH;IAtBsB,CAA3B;EAwBH;;AA9CwC,CAAvB,CAAtB","file":"newsWidgetModel.js","sourcesContent":["/**\n * State and operations for the administration UI's news widget.\n *\n * Model Attributes:\n *     maxItems (number):\n *         The maximum number of items to parse from the feed.\n *\n *     newsItems (Array of object):\n *         The list of news items to render. Each entry represents a news item,\n *         and is an object with the following keys:\n *\n *         ``date`` (:js:class:`Moment`):\n *             The parsed date.\n *\n *          ``title`` (string):\n *              The title of the news entry.\n *\n *          ``url`` (string):\n *              The URL to the news page for the item.\n *\n *     newsURL (string):\n *         The URL to the news page, for linking in the browser.\n *\n *     rssURL (string):\n *         The URL to the news RSS feed.\n *\n *     subscribeURL (string):\n *         The URL to a subscription page for the news feed or newsletter.\n */\nRB.Admin.NewsWidget = RB.Admin.Widget.extend({\n    defaults: _.defaults({\n        maxItems: 5,\n        newsItems: null,\n        newsURL: null,\n        rssURL: null,\n        subscribeURL: null,\n    }, RB.Admin.Widget.prototype.defaults),\n\n    /**\n     * Load the latest news from the server.\n     *\n     * This will attempt to load the news feed and populate the ``newsItems``\n     * attribute with the results. If there's an error when loading,\n     * ``newsItems`` will be set to an empty array.\n     *\n     * Before attempting to load the news, this will trigger the\n     * ``loadingNews`` event.\n     */\n    loadNews() {\n        this.trigger('loadingNews');\n\n        $.ajax(this.get('rssURL'), {\n            accepts: {\n                xml: 'application/rss+xml',\n            },\n            dataType: 'xml',\n            success: data => {\n                const maxItems = this.get('maxItems');\n                const $items = $(data).find(`item:lt(${maxItems})`);\n\n                this.set('newsItems', _.map($items, item => {\n                    const $item = $(item);\n\n                    return {\n                        date: moment($item.find('pubDate').text(),\n                                     'ddd, DD MMM YYYY HH:mm:ss ZZ'),\n                        title: $item.find('title').text(),\n                        url: $item.find('link').text(),\n                    };\n                }));\n            },\n            error: () => {\n                this.set('newsItems', []);\n            },\n        });\n    },\n});\n"]}