{"version":3,"sources":["changeEntryView.es6.js"],"names":[],"mappings":"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","file":"changeEntryView.js","sourcesContent":["(function() {\n\n\nconst ParentView = RB.ReviewRequestPage.BaseStatusUpdatesEntryView;\n\n\n/**\n * Displays the \"Review request changed\" entry on the review request page.\n *\n * This handles any rendering needed for special contents in the box,\n * such as the diff complexity icons and the file attachment thumbnails.\n */\nRB.ReviewRequestPage.ChangeEntryView = ParentView.extend({\n    /**\n     * Initialize the view.\n     *\n     * Args:\n     *     options (object):\n     *          Options for the view.\n     *\n     * Option Args:\n     *     reviewRequestEditorView (RB.ReviewRequestEditorView):\n     *         The review request editor.\n     */\n    initialize(options) {\n        ParentView.prototype.initialize.apply(this, arguments);\n\n        const reviewRequestEditor = this.model.get('reviewRequestEditor');\n\n        this.reviewRequest = reviewRequestEditor.get('reviewRequest');\n        this.reviewRequestEditorView = options.reviewRequestEditorView;\n\n        this._commitListView = null;\n\n        this._$boxStatus = null;\n        this._$fixItLabel = null;\n    },\n\n    /**\n     * Render the view.\n     *\n     * Returns:\n     *     RB.ReviewRequestPage.ChangeEntryView:\n     *     This object, for chaining.\n     */\n    render() {\n        ParentView.prototype.render.call(this);\n\n        this._$boxStatus = this.$('.box-status');\n        this._$fixItLabel = $('<label class=\"fix-it-label\">')\n            .hide()\n            .appendTo(this.$('.labels-container'));\n\n        RB.formatText(this.$('.changedesc-text'), {\n            bugTrackerURL: this.reviewRequest.get('bugTrackerURL'),\n            isHTMLEncoded: true,\n        });\n\n        this._updateLabels();\n\n        _.each(this.$('.diff-index tr'), rowEl => {\n            const $row = $(rowEl);\n            const iconView = new RB.DiffComplexityIconView({\n                numInserts: $row.data('insert-count'),\n                numDeletes: $row.data('delete-count'),\n                numReplaces: $row.data('replace-count'),\n                totalLines: $row.data('total-line-count'),\n            });\n\n            $row.find('.diff-file-icon')\n                .empty()\n                .append(iconView.$el);\n\n            iconView.render();\n        });\n\n        _.each(this.$('.file-container'), thumbnailEl => {\n            const $thumbnail = $(thumbnailEl);\n            const $caption = $thumbnail.find('.file-caption .edit');\n            const model = this.reviewRequest.draft.createFileAttachment({\n                id: $thumbnail.data('file-id')\n            });\n\n            if (!$caption.hasClass('empty-caption')) {\n                model.set('caption', $caption.text());\n            }\n\n            this.reviewRequestEditorView.buildFileAttachmentThumbnail(\n                model, null,\n                {\n                    $el: $thumbnail,\n                    canEdit: false,\n                });\n        });\n\n        const commits = this.model.get('commits');\n\n        if (commits) {\n            this._commitListView = new RB.DiffCommitListView({\n                el: this.$('.commit-list-container'),\n                model: new RB.DiffCommitList({\n                    commits: commits,\n                    diffHistory: new RB.CommitHistoryDiffEntryCollection(),\n                }),\n            });\n        }\n\n        return this;\n    },\n\n    /**\n     * Set up a review view.\n     *\n     * This will begin listening for changes to the issue counts and\n     * update the labels on the box.\n     *\n     * Args:\n     *     view (RB.ReviewRequestPage.ReviewView):\n     *         The review view being set up.\n     */\n    setupReviewView(view) {\n        this.listenTo(view, 'openIssuesChanged', this._updateLabels);\n    },\n\n    /**\n     * Update the \"Fix It\" label based on the open issue counts.\n     *\n     * If there are open issues, there will be a \"Fix it!\" label.\n     */\n    _updateLabels() {\n        if (this._reviewViews.some(view => view.hasOpenIssues())) {\n            const openIssueCount = this._reviewViews.reduce(\n                (sum, view) => sum + view.getOpenIssueCount(),\n                0);\n\n            this._$boxStatus.addClass('has-issues');\n            this._$fixItLabel\n                .empty()\n                .append(\n                    $('<span class=\"open-issue-count\">')\n                        .text(interpolate(gettext('%s failed'),\n                                          [openIssueCount]))\n                )\n                .append(document.createTextNode(gettext('Fix it!')))\n                .show()\n                .css({\n                    opacity: 1,\n                    left: 0,\n                });\n        } else {\n            this._$fixItLabel.css({\n                opacity: 0,\n                left: '-100px',\n            });\n            this._$boxStatus.removeClass('has-issues');\n        }\n    }\n});\n\n\n})();\n"]}