define(["@jupyter-widgets/base"],(e=>(()=>{"use strict";var n,t,o,i,r,s,a,u,c,l,d,_,b,p,f,g,m,v,h,w,x,y,j,k,O,S,E,V,A,F,T,W,M,P,q,D,L,C,N,J,z,I,R,U,B,G,K,Z,X,$,H,Q,Y,ee={820:(e,n,t)=>{t.r(n),t.d(n,{MODULE_NAME:()=>r,MODULE_VERSION:()=>i,VegaFusionModel:()=>a,VegaFusionView:()=>u});const o=t(147),i=o.version,r=o.name;var s=t(146);class a extends s.DOMWidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:a.model_name,_model_module:a.model_module,_model_module_version:a.model_module_version,_view_name:a.view_name,_view_module:a.view_module,_view_module_version:a.view_module_version,spec:null,full_vega_spec:null,client_vega_spec:null,server_vega_spec:null,vegafusion_handle:null,verbose:null,debounce_wait:30,debounce_max_wait:60,download_source_link:null,_request_msg:null,_response_msg:null})}}a.serializers=Object.assign(Object.assign({},s.DOMWidgetModel.serializers),{_request_msg:{serialize:e=>e.buffer?new DataView(e.buffer.slice(0)):null}}),a.model_name="VegaFusionModel",a.model_module=r,a.model_module_version=i,a.view_name="VegaFusionView",a.view_module=r,a.view_module_version=i;class u extends s.DOMWidgetView{async render(){const{embedVegaFusion:e}=await t.e(876).then(t.bind(t,876));this.embedVegaFusion=e;const{compile:n}=await t.e(647).then(t.bind(t,647));this.vegalite_compile=n,this.value_changed(),this.model.on("change:spec",this.value_changed,this),this.model.on("change:verbose",this.value_changed,this),this.model.on("change:debounce_wait",this.value_changed,this),this.model.on("change:debounce_max_wait",this.value_changed,this),this.model.on("change:download_source_link",this.value_changed,this),this.model.on("change:_response_msg",(()=>{const e=this.model.get("_response_msg");if(null!==e){this.model.get("verbose")&&(console.log("VegaFusion(js): Received response"),console.log(e.buffer));const n=new Uint8Array(e.buffer);this.vegafusion_handle.receive(n)}}))}value_changed(){let e=this.model.get("spec");if(null!==e){let n,t=JSON.parse(e);if(t.$schema.endsWith("schema/vega/v5.json"))n=e;else{let e=this.vegalite_compile(t);n=JSON.stringify(e.spec,null,2)}let o={verbose:this.model.get("verbose")||!1,debounce_wait:this.model.get("debounce_wait")||30,debounce_max_wait:this.model.get("debounce_max_wait"),download_source_link:this.model.get("download_source_link")};this.vegafusion_handle=this.embedVegaFusion(this.el,n,(e=>{this.model.get("verbose")&&console.log("VegaFusion(js): Send request"),this.model.set("_request_msg",new DataView(e.buffer)),this.touch(),this.model.set("_request_msg",{})}),o),this.model.set("full_vega_spec",n),this.model.set("client_vega_spec",this.vegafusion_handle.client_spec_json()),this.model.set("server_vega_spec",this.vegafusion_handle.server_spec_json()),this.model.set("comm_plan",this.vegafusion_handle.comm_plan_json()),this.touch()}}}window.__webpack_public_path__=document.querySelector("body").getAttribute("data-base-url")+"nbextensions/vegafusion-jupyter/"},146:n=>{n.exports=e},147:e=>{e.exports=JSON.parse('{"name":"vegafusion-jupyter","version":"0.9.0","description":"Altair Jupyter Widget library that relies on VegaFusion for serverside calculations","keywords":["jupyter","jupyterlab","jupyterlab-extension","widgets"],"files":["lib/**/*.js","dist/*.js","dist/*.wasm","css/*.css","css/*.scss","images/*.svg"],"homepage":"https://github.com/vegafusion/vegafusion","bugs":{"url":"https://github.com/vegafusion/vegafusion/issues"},"license":"AGPL-3.0-or-later","author":{"name":"VegaFusion Technologies LLC","email":"jon@vegafusion.io"},"main":"lib/index.js","types":"./lib/index.d.ts","repository":{"type":"git","url":"https://github.com/jonmmease/vegafusion"},"scripts":{"build:dev":"npm run build:lib && npm run build:nbextension && npm run build:labextension:dev && pip install --force-reinstall --no-deps -e .","build:prod":"npm run clean && npm run build:lib && npm run build:nbextension && npm run build:labextension","build:labextension":"jupyter labextension build .","build:labextension:dev":"jupyter labextension build --development True .","build:lib":"tsc && sass scss:css","build:nbextension":"webpack","clean":"npm run clean:lib && npm run clean:dist && npm run clean:nbextension && npm run clean:labextension","clean:dist":"rimraf dist","clean:lib":"rimraf lib","clean:labextension":"rimraf vegafusion_jupyter/labextension","clean:nbextension":"rimraf vegafusion_jupyter/nbextension/* && cp src/nbextension/extension.js vegafusion_jupyter/nbextension/","lint":"eslint . --ext .ts,.tsx --fix","lint:check":"eslint . --ext .ts,.tsx","prepack":"npm run build:prod","test":"jest","watch":"npm-run-all -p watch:*","watch:lib":"tsc -w","watch:nbextension":"webpack --watch --mode=development","watch:labextension":"jupyter labextension watch ."},"dependencies":{"@jupyter-widgets/base":"^1.1.10 || ^2.0.0 || ^3.0.0 || ^4.0.0","@jupyterlab/notebook":"^3.0.0 || ^4.0.0","marked":"^4.0.10","vega-lite":"^4.17.0","vegafusion-embed":"../../javascript/vegafusion-embed","vegafusion-wasm":"../../vegafusion-wasm/pkg"},"devDependencies":{"@babel/core":"^7.5.0","@babel/preset-env":"^7.5.0","@jupyterlab/builder":"^3.0.0","@phosphor/application":"^1.6.0","@phosphor/widgets":"^1.6.0","@types/jest":"^26.0.0","@types/webpack-env":"^1.16.3","@typescript-eslint/eslint-plugin":"^3.6.0","@typescript-eslint/parser":"^3.6.0","acorn":"^7.2.0","css-loader":"6.5.1","eslint":"^7.4.0","eslint-config-prettier":"^6.11.0","eslint-plugin-prettier":"^3.1.4","fs-extra":"^7.0.0","identity-obj-proxy":"^3.0.0","jest":"^26.0.0","mkdirp":"^0.5.1","npm-run-all":"^4.1.3","prettier":"^2.0.5","rimraf":"^2.6.2","sass":"^1.45.2","source-map-loader":"^1.1.3","style-loader":"^1.0.0","svg-inline-loader":"^0.8.2","ts-jest":"^26.0.0","ts-loader":"^8.0.0","typescript":"~4.1.3","webpack":"^5.65.0","webpack-cli":"^4.9.1","webpack-require-from":"^1.8.6"},"jupyterlab":{"extension":"lib/plugin","outputDir":"vegafusion_jupyter/labextension/","webpackConfig":"webpack.config.experimental.js","sharedPackages":{"@jupyter-widgets/base":{"bundled":false,"singleton":true}}}}')}},ne={};function te(e){var n=ne[e];if(void 0!==n)return n.exports;var t=ne[e]={id:e,loaded:!1,exports:{}};return ee[e].call(t.exports,t,t.exports,te),t.loaded=!0,t.exports}return te.m=ee,te.c=ne,n="function"==typeof Symbol?Symbol("webpack then"):"__webpack_then__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",o=e=>{e&&(e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},i=e=>!--e.r&&e(),r=(e,n)=>e?e.push(n):i(n),te.a=(e,s,a)=>{var u,c,l,d=a&&[],_=e.exports,b=!0,p=!1,f=(e,t,o)=>{p||(p=!0,t.r+=e.length,e.map(((e,i)=>e[n](t,o))),p=!1)},g=new Promise(((e,n)=>{l=n,c=()=>(e(_),o(d),d=0)}));g[t]=_,g[n]=(e,n)=>{if(b)return i(e);u&&f(u,e,n),r(d,e),g.catch(n)},e.exports=g,s((e=>{if(!e)return c();var s,a;u=(e=>e.map((e=>{if(null!==e&&"object"==typeof e){if(e[n])return e;if(e.then){var s=[];e.then((e=>{a[t]=e,o(s),s=0}));var a={};return a[n]=(n,t)=>(r(s,n),e.catch(t)),a}}var u={};return u[n]=e=>i(e),u[t]=e,u})))(e);var l=new Promise(((e,n)=>{(s=()=>e(a=u.map((e=>e[t])))).r=0,f(u,s,n)}));return s.r?l:a})).then(c,l),b=!1},te.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return te.d(n,{a:n}),n},te.d=(e,n)=>{for(var t in n)te.o(n,t)&&!te.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},te.f={},te.e=e=>Promise.all(Object.keys(te.f).reduce(((n,t)=>(te.f[t](e,n),n)),[])),te.u=e=>e+".index.js",te.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),te.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),te.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),s={},a="vegafusion-jupyter:",te.l=(e,n,t,o)=>{if(s[e])s[e].push(n);else{var i,r;if(void 0!==t)for(var u=document.getElementsByTagName("script"),c=0;c<u.length;c++){var l=u[c];if(l.getAttribute("src")==e||l.getAttribute("data-webpack")==a+t){i=l;break}}i||(r=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,te.nc&&i.setAttribute("nonce",te.nc),i.setAttribute("data-webpack",a+t),i.src=e),s[e]=[n];var d=(n,t)=>{i.onerror=i.onload=null,clearTimeout(_);var o=s[e];if(delete s[e],i.parentNode&&i.parentNode.removeChild(i),o&&o.forEach((e=>e(t))),n)return n(t)},_=setTimeout(d.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=d.bind(null,i.onerror),i.onload=d.bind(null,i.onload),r&&document.head.appendChild(i)}},te.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},te.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),te.p="",Object.defineProperty(te,"p",{get:function(){try{if("string"!=typeof __webpack_public_path__)throw new Error("WebpackRequireFrom: '__webpack_public_path__' is not a string or not available at runtime. See https://github.com/agoldis/webpack-require-from#troubleshooting");return __webpack_public_path__}catch(e){return console.error(e),""}},set:function(e){console.warn("WebpackRequireFrom: something is trying to override webpack public path. Ignoring the new value"+e+".")}}),(()=>{var e={179:0};te.f.j=(n,t)=>{var o=te.o(e,n)?e[n]:void 0;if(0!==o)if(o)t.push(o[2]);else{var i=new Promise(((t,i)=>o=e[n]=[t,i]));t.push(o[2]=i);var r=te.p+te.u(n),s=new Error;te.l(r,(t=>{if(te.o(e,n)&&(0!==(o=e[n])&&(e[n]=void 0),o)){var i=t&&("load"===t.type?"missing":t.type),r=t&&t.target&&t.target.src;s.message="Loading chunk "+n+" failed.\n("+i+": "+r+")",s.name="ChunkLoadError",s.type=i,s.request=r,o[1](s)}}),"chunk-"+n,n)}};var n=(n,t)=>{var o,i,[r,s,a]=t,u=0;if(r.some((n=>0!==e[n]))){for(o in s)te.o(s,o)&&(te.m[o]=s[o]);a&&a(te)}for(n&&n(t);u<r.length;u++)i=r[u],te.o(e,i)&&e[i]&&e[i][0](),e[i]=0},t=self.webpackChunkvegafusion_jupyter=self.webpackChunkvegafusion_jupyter||[];t.forEach(n.bind(null,0)),t.push=n.bind(null,t.push.bind(t))})(),H={},Q={724:function(){return{"./vegafusion_wasm_bg.js":{__wbindgen_object_drop_ref:function(e){return void 0===u&&(u=te.c[618].exports),u.ug(e)},__wbg_log_1b1e19938fac8fba:function(e,n){return void 0===c&&(c=te.c[618].exports),c.Em(e,n)},__wbg_setSignalValue_663921ecd7d96962:function(e,n,t,o,i,r){return void 0===l&&(l=te.c[618].exports),l.K1(e,n,t,o,i,r)},__wbg_setDataValue_cf52f0333fca60f0:function(e,n,t,o,i,r){return void 0===d&&(d=te.c[618].exports),d.ZF(e,n,t,o,i,r)},__wbg_run_52e29345651ae0d8:function(e){return void 0===_&&(_=te.c[618].exports),_.To(e)},__wbindgen_string_get:function(e,n){return void 0===b&&(b=te.c[618].exports),b.qt(e,n)},__wbg_msgreceiver_new:function(e){return void 0===p&&(p=te.c[618].exports),p.rx(e)},__wbg_toImageURL_55b7d098dc0b2a76:function(e,n,t,o){return void 0===f&&(f=te.c[618].exports),f.Zc(e,n,t,o)},__wbg_localTimezone_a2deac476bc5f76a:function(e){return void 0===g&&(g=te.c[618].exports),g.VA(e)},__wbg_parse_4b42011a5be62caf:function(e){return void 0===m&&(m=te.c[618].exports),m.fF(e)},__wbg_new_658a94817aac9c12:function(e){return void 0===v&&(v=te.c[618].exports),v.J$(e)},__wbg_initialize_45456f30b4ebaae3:function(e,n){return void 0===h&&(h=te.c[618].exports),h.GI(e,n)},__wbg_hover_9196113e3355da3e:function(e){return void 0===w&&(w=te.c[618].exports),w.Rk(e)},__wbg_setupTooltip_27a1a15d0f805193:function(e){return void 0===x&&(x=te.c[618].exports),x.E7(e)},__wbindgen_object_clone_ref:function(e){return void 0===y&&(y=te.c[618].exports),y.m_(e)},__wbg_addSignalListener_5d607234a1199e43:function(e,n,t,o,i,r,s,a,u){return void 0===j&&(j=te.c[618].exports),j.CQ(e,n,t,o,i,r,s,a,u)},__wbg_addDataListener_466c864cd59d2cd3:function(e,n,t,o,i,r,s,a,u){return void 0===k&&(k=te.c[618].exports),k.ZD(e,n,t,o,i,r,s,a,u)},__wbg_vegaversion_9ebbbf6f34bcb383:function(e){return void 0===O&&(O=te.c[618].exports),O.jA(e)},__wbg_makegrpcsendmessagefn_4eb69b21eb3a1d23:function(e,n,t){return void 0===S&&(S=te.c[618].exports),S.KI(e,n,t)},__wbg_new_693216e109162396:function(){return void 0===E&&(E=te.c[618].exports),E.Ih()},__wbg_stack_0ddaca5d1abfb52f:function(e,n){return void 0===V&&(V=te.c[618].exports),V.yq(e,n)},__wbg_error_09919627ac0992f5:function(e,n){return void 0===A&&(A=te.c[618].exports),A.gk(e,n)},__wbg_instanceof_Window_c4b70662a0d2c5ec:function(e){return void 0===F&&(F=te.c[618].exports),F.Um(e)},__wbg_document_1c64944725c0d81d:function(e){return void 0===T&&(T=te.c[618].exports),T.WS(e)},__wbg_newnoargs_be86524d73f67598:function(e,n){return void 0===W&&(W=te.c[618].exports),W.wg(e,n)},__wbg_call_888d259a5fefc347:function(e,n){return void 0===M&&(M=te.c[618].exports),M.BT(e,n)},__wbg_self_c6fbdfc2918d5e58:function(){return void 0===P&&(P=te.c[618].exports),P.JX()},__wbg_window_baec038b5ab35c54:function(){return void 0===q&&(q=te.c[618].exports),q.xd()},__wbg_globalThis_3f735a5746d41fbd:function(){return void 0===D&&(D=te.c[618].exports),D.ud()},__wbg_global_1bc0b39582740e95:function(){return void 0===L&&(L=te.c[618].exports),L.PT()},__wbindgen_is_undefined:function(e){return void 0===C&&(C=te.c[618].exports),C.XP(e)},__wbg_call_8a893cac80deeb51:function(e,n,t,o){return void 0===N&&(N=te.c[618].exports),N.bO(e,n,t,o)},__wbg_getTimezoneOffset_d3e5a22a1b7fb1d8:function(e){return void 0===J&&(J=te.c[618].exports),J.LJ(e)},__wbg_new0_fd3a3a290b25cdac:function(){return void 0===z&&(z=te.c[618].exports),z.qs()},__wbg_buffer_397eaa4d72ee94dd:function(e){return void 0===I&&(I=te.c[618].exports),I.jp(e)},__wbg_newwithbyteoffsetandlength_4b9b8c4e3f5adbff:function(e,n,t){return void 0===R&&(R=te.c[618].exports),R.WK(e,n,t)},__wbg_new_a7ce447f15ff496f:function(e){return void 0===U&&(U=te.c[618].exports),U.y4(e)},__wbg_parse_ccb2cd4fe8ead0cb:function(e,n){return void 0===B&&(B=te.c[618].exports),B.SG(e,n)},__wbg_stringify_d4507a59932eed0c:function(e){return void 0===G&&(G=te.c[618].exports),G.li(e)},__wbindgen_debug_string:function(e,n){return void 0===K&&(K=te.c[618].exports),K.fY(e,n)},__wbindgen_throw:function(e,n){return void 0===Z&&(Z=te.c[618].exports),Z.Or(e,n)},__wbindgen_memory:function(){return void 0===X&&(X=te.c[618].exports),X.oH()},__wbindgen_closure_wrapper326:function(e,n,t){return void 0===$&&($=te.c[618].exports),$.EO(e,n,t)}}}}},Y={594:[724]},te.w={},te.f.wasm=function(e,n){(Y[e]||[]).forEach((function(t,o){var i=H[t];if(i)n.push(i);else{var r,s=Q[t](),a=fetch(te.p+""+{594:{724:"dd26c06fe123c372953b"}}[e][t]+".module.wasm");r=s&&"function"==typeof s.then&&"function"==typeof WebAssembly.compileStreaming?Promise.all([WebAssembly.compileStreaming(a),s]).then((function(e){return WebAssembly.instantiate(e[0],e[1])})):"function"==typeof WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(a,s):a.then((function(e){return e.arrayBuffer()})).then((function(e){return WebAssembly.instantiate(e,s)})),n.push(H[t]=r.then((function(e){return te.w[t]=(e.instance||e).exports})))}}))},te(820)})()));